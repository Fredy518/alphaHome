# ç¦»çº¿ç‰¹å¾å·¥ç¨‹æ¨¡å—è®¾è®¡æ–¹æ¡ˆ

> **çŠ¶æ€**: è®¾è®¡ä¸­  
> **åˆ›å»ºæ—¥æœŸ**: 2026-01-27  
> **æœ€åæ›´æ–°**: 2026-01-29  
> **ä½œè€…**: alphahome team

---

## 1. èƒŒæ™¯ä¸åŠ¨æœº

### 1.1 é—®é¢˜é™ˆè¿°

å½“å‰ alphahome é¡¹ç›®å­˜åœ¨ä»¥ä¸‹æ¶æ„é—®é¢˜ï¼š

| é—®é¢˜ | ç°çŠ¶æè¿° |
|------|----------|
| **processors è¿‡é‡** | processors æ¨¡å—è®¾è®¡äº†å®Œæ•´çš„å¼•æ“å±‚/ä»»åŠ¡å±‚/æ“ä½œå±‚/Cleanå±‚/ç‰©åŒ–è§†å›¾å­ç³»ç»Ÿï¼Œä½†å¯¹äºä¸ªäººé‡åŒ–å¹³å°è€Œè¨€è¿‡äºå¤æ‚ï¼Œå®é™…æŠ•å…¥ç”Ÿäº§ä½¿ç”¨çš„éƒ¨åˆ†å¾ˆå°‘ |
| **ç‰¹å¾æ¨¡å—ç©ºç½®** | `alphahome/factors/` ä¸ºç©ºå£³ç›®å½•ï¼Œæœªè¢«å®é™…ä½¿ç”¨ |
| **ç‰¹å¾èƒ½åŠ›åˆ†æ•£** | PIT æ•°æ®åœ¨ `research/pit_data/`ã€ç‰©åŒ–è§†å›¾åœ¨ `processors/materialized_views/`ã€Barra å› å­åœ¨ `alphahome/barra/`ï¼Œç¼ºä¹ç»Ÿä¸€çš„ç‰¹å¾å·¥ç¨‹å…¥å£ |
| **data_infra å®šä½æ¨¡ç³Š** | å¤–éƒ¨ QuantLab é¡¹ç›®çš„ data_infra æ¨¡å—æœ‰ 35+ Fetcherï¼Œä½†å…¶è¯­ä¹‰æ˜¯"ä» alphadb è¯»å–"è€Œé"å†™å…¥ alphadb"ï¼Œä¸ alphahome çš„ç”Ÿäº§è€…å®šä½ä¸ç¬¦ |

### 1.2 ç›®æ ‡

1. **è½»è£…ä¸Šé˜µ**ï¼šåºŸå¼ƒå¹¶åˆ é™¤ processors æ¨¡å—ï¼Œé™ä½ç»´æŠ¤æˆæœ¬
2. **æ˜ç¡®å®šä½**ï¼šalphahome å®šä½ä¸º"ç¦»çº¿ç‰¹å¾ç”Ÿäº§å·¥å‚"ï¼Œåªè´Ÿè´£å†™å…¥ alphadbï¼Œä¸åšåœ¨çº¿æœåŠ¡
3. **ç»Ÿä¸€å…¥å£**ï¼šå»ºç«‹ `features` æ¨¡å—ä½œä¸ºç¦»çº¿ç‰¹å¾å·¥ç¨‹çš„å”¯ä¸€å…¥å£
4. **ç‰¹å¾ç”„åˆ«**ï¼šå¯¹ data_infra åšç‰¹å¾å…¥åº“æ¸…å•ç”„åˆ«ï¼ŒåªæŠŠåº”æ²‰æ·€çš„æ ¸å¿ƒç‰¹å¾è½åº“

### 1.3 éç›®æ ‡

- âŒ ä¸ä¿ç•™è¿ç»´/ç”Ÿäº§ CLIï¼ˆ`refresh-materialized-view`ã€`ah`/`alphahome-cli`ã€`alphahome-ddb` å…¨éƒ¨ä¸‹çº¿ï¼›å¿…è¦æ—¶ä»¥è„šæœ¬æˆ– Python API æ›¿ä»£ï¼Œç­‰ features ç¨³å®šåå†è€ƒè™‘æ¢å¤ï¼‰
- âŒ Barra å› å­ä¸çº³å…¥ features æ¨¡å—ï¼ˆä¿æŒç‹¬ç«‹çš„ `alphahome/barra/`ï¼‰
- âŒ ä¸åšåœ¨çº¿ç‰¹å¾æœåŠ¡å±‚

### 1.4 CLI è¾¹ç•Œè¯´æ˜

| å…¥å£ | ç±»å‹ | æœ¬æ¬¡å¤„ç½® | è¯´æ˜ |
|------|------|----------|------|
| `alphahome` | GUI launcher | **ä¿ç•™** | ç”¨äºå¯åŠ¨ GUI åº”ç”¨ï¼Œä¸è¿ç»´ CLI æ— å…³ |
| `refresh-materialized-view` | è¿ç»´ CLI | ä¸‹çº¿ | è¿ç§»åˆ° `scripts/` è„šæœ¬ |
| `ah` / `alphahome-cli` | ç»Ÿä¸€ CLI | ä¸‹çº¿ | è¿‡é‡ï¼Œfeatures ç¨³å®šåæŒ‰éœ€æ¢å¤ |
| `alphahome-ddb` | DolphinDB CLI | ä¸‹çº¿ | å¯é€‰ï¼ŒæŒ‰éœ€æ¢å¤ |

---

## 2. ç°çŠ¶åˆ†æ

### 2.1 processors å¤–éƒ¨ä¾èµ–ç‚¹ç›˜ç‚¹

#### 2.1.1 CLI å…¥å£ä¾èµ–

| å…¥å£ç±»å‹ | æ–‡ä»¶è·¯å¾„ | ä¾èµ–ç¬¦å· | å¤„ç½®æ–¹å¼ |
|----------|----------|----------|----------|
| console_script | `pyproject.toml` â†’ `refresh-materialized-view` | æ—§ `processors.materialized_views.cli:main_sync`ï¼ˆå·²åˆ é™¤ï¼‰ | ç§»é™¤å…¥å£ |
| console_script | `pyproject.toml` â†’ `ah` / `alphahome-cli` | `alphahome.cli.main:main_sync` | ä¸‹çº¿ç»Ÿä¸€ CLIï¼ˆæ•´å¥— cli/ å­åŒ…å¯ç§»é™¤ï¼‰ |
| console_script | `pyproject.toml` â†’ `alphahome-ddb` | `alphahome.integrations.dolphindb.cli:main_sync` | æ˜¯å¦ä¸€å¹¶ä¸‹çº¿ï¼ˆæœ¬æ–¹æ¡ˆé»˜è®¤ä¸‹çº¿ï¼‰ |
| CLI å­å‘½ä»¤ | `alphahome/cli/commands/mv.py` | åŠ¨æ€ import æ—§ `processors.materialized_views.cli`ï¼ˆå·²åˆ é™¤ï¼‰ | ä¸‹çº¿å‘½ä»¤ç»„ï¼ˆä¸å†æä¾› mv ç®¡ç†ï¼‰ |
| CLI æ³¨å†Œ | `alphahome/cli/commands/registry.py` | `MVCommandGroup` ç­‰ | ç§»é™¤æ³¨å†Œ / ç§»é™¤æ•´ä¸ª cli å­åŒ… |

#### 2.1.2 scripts ä¾èµ–

| è„šæœ¬è·¯å¾„ | ä¾èµ–ç¬¦å· | å¤„ç½®æ–¹å¼ |
|----------|----------|----------|
| `scripts/initialize_materialized_views.py` | `MaterializedViewDatabaseInit` | è¿ç§»åˆ° features æˆ–æ”¹ä¸ºç‹¬ç«‹è„šæœ¬ |
| `scripts/run_barra_batch.py` | `BarraExposuresDailyTask`, `BarraExposuresFullTask`, `BarraFactorReturnsDailyTask` | æ”¹ä¸ºç›´æ¥è°ƒç”¨ `alphahome/barra/`ï¼ˆæˆ–åœ¨ scripts å†…è‡ªåŒ…å«è®¡ç®—å…¥å£ï¼‰ |
| `scripts/debug_run_barra_day.py` | `BarraExposuresDailyTask`, `BarraFactorReturnsDailyTask` | åŒä¸Š |

#### 2.1.3 tests ä¾èµ–

| æµ‹è¯•è·¯å¾„ | ä¾èµ–ç¬¦å· | å¤„ç½®æ–¹å¼ |
|----------|----------|----------|
| `tests/unit/test_barra/test_wls_regression.py` | `BarraFactorReturnsDailyTask`ï¼ˆåŸæ¥è‡ªæ—§ `processors.tasks.barra.*`ï¼‰ | âœ… å·²æ”¹ä¸ºä» `alphahome.barra.tasks` å¯¼å…¥ |
| `tests/unit/test_barra/test_factor_calculators.py` | - | âœ… å·²æ ¸å¯¹ï¼šæ—  processors ä¾èµ– |

### 2.2 processors å†…éƒ¨æ¨¡å—åˆ†ç±»

| åˆ†ç±» | æ¨¡å—è·¯å¾„ | å¤„ç½®å†³ç­– |
|------|----------|----------|
| **éœ€è¿ç§»** | `processors/materialized_views/` | è¿ç§»æ ¸å¿ƒèƒ½åŠ›åˆ° `features/storage/` |
| **éœ€è§£è€¦** | `processors/tasks/barra/` | Barra è„šæœ¬æ”¹ä¸ºç›´æ¥è°ƒç”¨ `barra/` æ¨¡å—ï¼ˆè¯¥å·¥ä½œä¸ features æ— å…³ï¼Œä½†å¯¹â€œåˆ é™¤ processorsâ€æ˜¯ç¡¬å‰ç½®ï¼‰ |
| **å¯åºŸå¼ƒ** | `processors/engine/` | è¿‡é‡çš„è°ƒåº¦å¼•æ“ï¼ŒåºŸå¼ƒ |
| **å¯åºŸå¼ƒ** | `processors/tasks/` (é barra) | æœªæŠ•å…¥ç”Ÿäº§ï¼ŒåºŸå¼ƒ |
| **å¯åºŸå¼ƒ** | `processors/clean/` | Clean Layer æ¦‚å¿µè¿‡é‡ï¼ŒåºŸå¼ƒ |
| **å¯åºŸå¼ƒ** | `processors/operations/` | å‡ ä¹æ— å¤–éƒ¨å¼•ç”¨ï¼ŒåºŸå¼ƒï¼ˆå¦‚éœ€ä¿ç•™å¯è¿è‡³ commonï¼‰ |
| **å¯åºŸå¼ƒ** | `processors/domain/` | åºŸå¼ƒ |

### 2.3 ç‰©åŒ–è§†å›¾å­ç³»ç»Ÿæ ¸å¿ƒèƒ½åŠ›

éœ€è¦è¿ç§»åˆ° `features/storage/` çš„æœ€å°æ¥å£ï¼š

| èƒ½åŠ› | æºæ–‡ä»¶ | è¿ç§»åä½ç½® | è¯´æ˜ |
|------|--------|------------|------|
| SQL æ¨¡æ¿ç”Ÿæˆ | `sql_templates.py` | `features/storage/sql_templates.py` | PIT/èšåˆ/JOIN ä¸‰ç§æ¨¡æ¿ |
| åˆ·æ–°æ‰§è¡Œå™¨ | `refresh.py` | `features/storage/refresh.py` | FULL/CONCURRENT åˆ·æ–° |
| è´¨é‡æ ¡éªŒ | `validator.py` | `features/storage/validator.py` | æ•°æ®è´¨é‡æ£€æŸ¥ |
| æ•°æ®åº“åˆå§‹åŒ– | `database_init.py` | `features/storage/database_init.py` | schema/å…ƒæ•°æ®è¡¨åˆ›å»º |
| ä»»åŠ¡åŸºç±» | `base_task.py` | `features/storage/base_view.py` | ç‰©åŒ–è§†å›¾ä»»åŠ¡æŠ½è±¡ |

è¡¥å……è¯´æ˜ï¼š
- å½“å‰ `processors/materialized_views/cli.py` å†…ç½®äº†ä¸€ä¸ª `MATERIALIZED_VIEWS` æ³¨å†Œè¡¨ï¼Œå¹¶ç›´æ¥ import å¤šä¸ª `processors/tasks/*/*_mv.py` è§†å›¾å®šä¹‰ç±»ã€‚
- ç”±äºæœ¬æ–¹æ¡ˆä¸ä¿ç•™ CLIï¼Œæ³¨å†Œè¡¨å¯ç›´æ¥ç§»é™¤ï¼Œä½†"è§†å›¾å®šä¹‰ï¼ˆview definitionsï¼‰"æœ¬èº«å¿…é¡»è¿ç§»åˆ° `features`ï¼ˆå»ºè®®æ”¾åœ¨ `features/recipes/mv/`ï¼‰ï¼Œå¦åˆ™è¿ç§»åçš„ storage å±‚åªæœ‰åŸºç¡€è®¾æ–½æ²¡æœ‰äº§ç‰©ã€‚

**éœ€è¿ç§»çš„ MV å®šä¹‰æ–‡ä»¶**ï¼ˆå…± 4 ä¸ªï¼‰ï¼š

| æºè·¯å¾„ | è¿ç§»åè·¯å¾„ | è¯´æ˜ |
|--------|------------|------|
| `processors/tasks/pit/pit_financial_indicators_mv.py` | `features/recipes/mv/stock/stock_fina_indicator.py` | è´¢åŠ¡æŒ‡æ ‡ï¼ˆPIT æ—¶é—´çª—å£ï¼‰ |
| `processors/tasks/pit/pit_industry_classification_mv.py` | `features/recipes/mv/stock/stock_industry_monthly_snapshot.py` | è¡Œä¸šåˆ†ç±»ï¼ˆæœˆåº¦å¿«ç…§ï¼Œsw+ciï¼‰ |
| `processors/tasks/market/market_technical_indicators_mv.py` | `features/recipes/mv/stock/stock_daily_enriched.py` | æ¯æ—¥è¡Œæƒ…å¢å¼ºï¼ˆåœ¨ stock åŸŸè½åº“ï¼‰ |
| `processors/tasks/market/sector_aggregation_mv.py` | `features/recipes/mv/market/market_stats_daily.py` | å¸‚åœºæ¨ªæˆªé¢ç»Ÿè®¡ |

---

## 3. ç›®æ ‡æ¶æ„

### 3.1 æ¨¡å—èŒè´£é‡æ–°å®šä¹‰

```
alphahome/
â”œâ”€â”€ common/                    # åŸºç¡€è®¾æ–½ï¼ˆä¿æŒä¸å˜ï¼‰
â”‚   â”œâ”€â”€ db_manager.py
â”‚   â”œâ”€â”€ config_manager.py
â”‚   â”œâ”€â”€ task_system/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ fetchers/                  # æ•°æ®è·å–ï¼ˆä¿æŒä¸å˜ï¼‰
â”‚   â””â”€â”€ ...
â”œâ”€â”€ features/                  # ã€æ–°å»ºã€‘ç¦»çº¿ç‰¹å¾å·¥ç¨‹
â”‚   â”œâ”€â”€ storage/               # ç‰¹å¾å­˜å‚¨å±‚ï¼ˆç‰©åŒ–è§†å›¾ï¼‰
â”‚   â”œâ”€â”€ pit/                   # PIT æ—¶åºç‰¹å¾
â”‚   â”œâ”€â”€ recipes/               # ç‰¹å¾è®¡ç®—é…æ–¹
â”‚   â””â”€â”€ registry.py            # ç‰¹å¾æ³¨å†Œè¡¨
â”œâ”€â”€ barra/                     # Barra é£é™©æ¨¡å‹ï¼ˆä¿æŒç‹¬ç«‹ï¼‰
â”‚   â””â”€â”€ ...
â”œâ”€â”€ integrations/              # å¤–éƒ¨é›†æˆï¼ˆä¿æŒä¸å˜ï¼‰
â””â”€â”€ [processors/]              # ã€åºŸå¼ƒåˆ é™¤ã€‘
```

### 3.2 features æ¨¡å—è®¾è®¡

```
alphahome/features/
â”œâ”€â”€ __init__.py                # ç»Ÿä¸€å¯¼å‡º
â”œâ”€â”€ storage/                   # ç‰¹å¾å­˜å‚¨å±‚
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ base_view.py           # ç‰©åŒ–è§†å›¾ä»»åŠ¡åŸºç±»
â”‚   â”œâ”€â”€ refresh.py             # åˆ·æ–°æ‰§è¡Œå™¨
â”‚   â”œâ”€â”€ sql_templates.py       # SQL æ¨¡æ¿ç”Ÿæˆå™¨
â”‚   â”œâ”€â”€ validator.py           # æ•°æ®è´¨é‡éªŒè¯
â”‚   â””â”€â”€ database_init.py       # Schema åˆå§‹åŒ–
â”œâ”€â”€ pit/                       # PIT æ—¶åºç‰¹å¾ï¼ˆå½“å‰ä»…å ä½ï¼›å®Œæ•´è¿ç§»è§ Section 6ï¼‰
â”‚   â””â”€â”€ __init__.py
â”œâ”€â”€ recipes/                   # ç‰¹å¾è®¡ç®—é…æ–¹
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ base_recipe.py         # é…æ–¹åŸºç±»
â”‚   â”œâ”€â”€ mv/                     # ç”¨ SQL/MV å®ç°çš„ç‰¹å¾é…æ–¹ï¼ˆæ¨èï¼‰
â”‚   â”œâ”€â”€ python/                 # å¿…é¡»ç”¨ Python è®¡ç®—çš„ç¦»çº¿ç‰¹å¾ï¼ˆè°¨æ…ä½¿ç”¨ï¼Œä¼˜å…ˆè½åº“åå†æ¶ˆè´¹ï¼‰
â”‚   â””â”€â”€ ... (æŒ‰ç‰¹å¾ç”„åˆ«æ¸…å•é€æ­¥æ·»åŠ )
â”œâ”€â”€ cards/                     # å…¥åº“å¡ç‰‡ï¼ˆYAMLï¼‰
â”‚   â””â”€â”€ <feature_name>.yaml    # æ¯ä¸ªå…¥åº“ç‰¹å¾ä¸€å¼ å¡ç‰‡
â””â”€â”€ registry.py                # FeatureRegistry ç»Ÿä¸€è®¿é—®
```

#### 3.2.1 å‘½åä¸ç›®å½•è§„èŒƒï¼ˆå¯¹é½ fetchers çš„â€œå¯è¯»æ€§ä¼˜å…ˆâ€ï¼‰

> ç›®çš„ï¼šè®©æ–°åŒå­¦åªçœ‹è·¯å¾„/æ–‡ä»¶åå°±èƒ½æ¨æ–­â€œè¿™æ˜¯ä»€ä¹ˆç‰¹å¾ã€å±äºå“ªä¸ªåŸŸã€å¦‚ä½•è½åº“ã€å¦‚ä½•åˆ·æ–°â€ã€‚

æ ¸å¿ƒåŸåˆ™ï¼š
1. **ç›®å½•è¡¨è¾¾è¯­ä¹‰ï¼Œæ–‡ä»¶åä¿æŒçŸ­è€Œç¨³å®š**ï¼šrecipes çš„ç±»å‹ï¼ˆmv/pythonï¼‰ç”±ç›®å½•è¡¨è¾¾ï¼›ä¸šåŠ¡åŸŸç”±å­ç›®å½•è¡¨è¾¾ã€‚
2. **ä¸€ä¸ªç‰¹å¾é…æ–¹ = ä¸€ä¸ªæ–‡ä»¶ = ä¸€ä¸ªç±» = ä¸€å¼ å¡ç‰‡**ï¼šå½¢æˆå¯è¿½æº¯çš„æœ€å°é—­ç¯ã€‚
3. **ç¨³å®šæ ‡è¯†ä¼˜å…ˆ**ï¼šç‰¹å¾çš„ `recipe.name`ï¼ˆå”¯ä¸€æ ‡è¯†ï¼‰ä¸€æ—¦å‘å¸ƒåº”å°½é‡ä¸å˜ï¼›é‡å‘½åè§†ä¸ºç ´åæ€§å˜æ›´ã€‚

ç›®å½•ç»“æ„è§„èŒƒï¼ˆå¼ºåˆ¶ï¼‰ï¼š
```
alphahome/features/recipes/
â”œâ”€â”€ mv/
â”‚   â”œâ”€â”€ stock/
â”‚   â”œâ”€â”€ market/
â”‚   â””â”€â”€ ...ï¼ˆå…è®¸æ–°å¢åŸŸï¼šindex/fund/macro/option/future/...ï¼‰
â””â”€â”€ python/
    â”œâ”€â”€ stock/
    â””â”€â”€ ...ï¼ˆè°¨æ…ä½¿ç”¨ï¼Œä¼˜å…ˆç”¨ mv è½åº“ï¼‰
```

å‘½åä¸‰ä»¶å¥—è§„èŒƒï¼ˆå¼ºåˆ¶ï¼‰ï¼š

1) æ–‡ä»¶åï¼ˆmodule nameï¼‰
- è§„åˆ™ï¼š`{recipe_name}.py`
- çº¦æŸï¼š`recipe_name` å¿…é¡»æ˜¯ `snake_case`ï¼Œä¸”åœ¨å…¨ä»“åº“å†…å»ºè®®å”¯ä¸€ï¼ˆè‡³å°‘åœ¨ features/recipes èŒƒå›´å†…å”¯ä¸€ï¼‰ã€‚
- ç¤ºä¾‹ï¼š
  - `recipes/mv/stock/stock_daily_enriched.py`
  - `recipes/mv/stock/stock_fina_indicator.py`
  - `recipes/mv/stock/stock_industry_monthly_snapshot.py`
  - `recipes/mv/market/market_stats_daily.py`

2) ç±»åï¼ˆRecipe class nameï¼‰
- è§„åˆ™ï¼š`{RecipeName}{TypeSuffix}`ï¼Œå…¶ä¸­ `TypeSuffix` åœ¨ mv ä¸­å›ºå®šä¸º `MV`ã€‚
- ç¤ºä¾‹ï¼š
  - `StockDailyEnrichedMV`
  - `StockFinaIndicatorMV`
  - `StockSwIndustryMV`
  - `MarketStatsMV`

3) é…æ–¹å”¯ä¸€æ ‡è¯†ï¼ˆrecipe.nameï¼‰
- è§„åˆ™ï¼šä¸æ–‡ä»¶åä¸€è‡´ï¼Œå– `{recipe_name}`ï¼ˆä¸å¸¦ `.py`ï¼‰ï¼Œä¾‹å¦‚ `market_stats`ã€‚
- è¯´æ˜ï¼šé¿å…æŠŠ `_mv` å†™è¿› `recipe.name`ï¼Œå› ä¸º MV åªæ˜¯å®ç°å½¢æ€ï¼›æœªæ¥è¿ç§»ä¸º table ä»èƒ½ä¿æŒ name ä¸å˜ã€‚

è¾“å‡ºå¯¹è±¡å‘½åè§„èŒƒï¼ˆå¼ºåˆ¶ï¼‰ï¼š
- MV è¾“å‡ºè¡¨åï¼š`mv_{recipe.name}`ï¼Œschema å›ºå®šä¸º `features`ã€‚
  - ä¾‹ï¼š`features.mv_market_stats`
- é MVï¼ˆæ™®é€šè¡¨ï¼‰è¾“å‡ºè¡¨åï¼šé»˜è®¤ `features.{recipe.name}`ï¼›å¦‚éœ€åŒºåˆ†å¯å¼•å…¥å‰ç¼€ `feat_`ï¼Œä½†éœ€åœ¨å¡ç‰‡ä¸­è¯´æ˜åŸå› ã€‚

å¡ç‰‡æ–‡ä»¶è§„èŒƒï¼ˆå¼ºåˆ¶ï¼‰ï¼š
- è·¯å¾„ï¼š`alphahome/features/cards/{recipe.name}.yaml`
- è¦æ±‚ï¼šå¡ç‰‡ä¸­çš„ `feature_name` å¿…é¡»ç­‰äº `recipe.name`ã€‚

å…³äºâ€œæ˜¯å¦ç»™æ–‡ä»¶ååŠ  mv_ å‰ç¼€â€çš„å†³ç­–ï¼š
- ç†ç”±ï¼šå‡å°‘å†—ä½™ï¼›é¿å…å‡ºç° `mv/mv_xxx.py` çš„é‡å¤è¯­ä¹‰ï¼›ä¸â€œç›®å½•è¡¨è¾¾è¯­ä¹‰â€çš„åŸåˆ™ä¸€è‡´ã€‚

#### 3.2.2 Recipe çš„ç»„ç»‡æ–¹å¼ï¼ˆå€Ÿé‰´ fetchers çš„â€œåˆ†å±‚ + è‡ªåŠ¨å‘ç°â€ï¼‰

- fetchers çš„å¯è¯»æ€§æ¥è‡ªäºï¼š`tasks/{domain}/` åˆ†ç»„ + æ˜ç¡®å‘½å + è£…é¥°å™¨æ³¨å†Œã€‚
- features é‡‡å–åŒæ ·ç­–ç•¥ï¼š`recipes/{type}/{domain}/` åˆ†ç»„ + ç»Ÿä¸€å‘½åä¸‰ä»¶å¥— + æ³¨å†Œ/å‘ç°æœºåˆ¶ã€‚

features ä¸å¼•å…¥ fetchers çš„ç‚¹ï¼š
- ä¸å¼•å…¥â€œæ•°æ®æºå‰ç¼€â€ï¼ˆtushare/akshareï¼‰ï¼Œå› ä¸º features çš„è¾“å…¥æ¥è‡ª alphadb å†…éƒ¨è¡¨ï¼Œæ•°æ®æºå·®å¼‚é€šè¿‡ `source_tables` è¡¨è¾¾å³å¯ã€‚
- ä¸å¤ç”¨ fetchers çš„ UnifiedTaskFactoryï¼›features çš„ç”Ÿå‘½å‘¨æœŸæ›´åâ€œå®šä¹‰/åˆå§‹åŒ–/åˆ·æ–°/æ ¡éªŒâ€ï¼Œç”± `FeatureRegistry` ç»Ÿä¸€ç®¡ç†ã€‚

### 3.3 features æ ¸å¿ƒæ¥å£å¥‘çº¦

#### 3.3.1 BaseFeatureViewï¼ˆå·²è½åœ°ï¼šMV é…æ–¹åŸºç±»ï¼‰

å½“å‰ä»“åº“é‡Œâ€œå¯è¿è¡Œçš„æœ€å°é—­ç¯â€ä»¥ MV ä¸ºä¸»ï¼Œé…æ–¹ç±»ç»Ÿä¸€ç»§æ‰¿ `BaseFeatureView`ï¼ˆä½äº `alphahome/features/storage/base_view.py`ï¼‰ã€‚

è½åœ°åçš„æœ€å°å¥‘çº¦ï¼ˆä¸ä»£ç ä¸€è‡´ï¼‰ï¼š

```python
class BaseFeatureView:
  # === å…ƒä¿¡æ¯ï¼ˆå¿…å¡«ï¼Œæ³¨å†Œé˜¶æ®µæ ¡éªŒï¼‰===
  name: str
  description: str
  source_tables: List[str]

  # === å¯é€‰é…ç½® ===
  refresh_strategy: str = "full"        # full / concurrent
  materialized_view_name: str = ""      # ä¸ºç©ºåˆ™é»˜è®¤ mv_{name}
  quality_checks: Dict[str, Any] = {}

  # === å‘½åçº¦æŸï¼ˆå¼ºåˆ¶ï¼‰===
  # schema å›ºå®šä¸º featuresï¼›full_name = features.mv_{name}

  def get_create_sql(self) -> str:
    ...  # è¿”å›å®Œæ•´ CREATE MATERIALIZED VIEW features.mv_{name} ...

  def get_post_create_sqls(self) -> List[str]:
    ...  # å¯é€‰ï¼šåˆ›å»ºåé™„åŠ  DDLï¼ˆé€šå¸¸ç”¨äº CREATE INDEX IF NOT EXISTS ...ï¼‰
```

è¯´æ˜ï¼šæ–‡æ¡£ä¸­çš„â€œæ—¶é—´è¯­ä¹‰/PIT å®‰å…¨/è´¨é‡è§„åˆ™â€ç­‰æ›´å®Œæ•´å…ƒä¿¡æ¯ï¼Œå½“å‰æ¨èé€šè¿‡ cardsï¼ˆYAMLï¼‰æ‰¿è½½ï¼›ä»£ç å±‚çš„å¼ºæ ¡éªŒä»¥ `name/description/source_tables` ä¸ºä¸»ï¼Œé¿å…åœ¨ import é˜¶æ®µå¼•å…¥é‡é€»è¾‘ã€‚

#### 3.3.2 FeatureRegistryï¼ˆç‰¹å¾æ³¨å†Œè¡¨ï¼‰

ç»Ÿä¸€ç®¡ç†æ‰€æœ‰å·²å…¥åº“ç‰¹å¾çš„å‘ç°ã€åˆ·æ–°ã€æ ¡éªŒï¼š

```python
class FeatureRegistry:
    """ç‰¹å¾æ³¨å†Œè¡¨"""
    
    @classmethod
    def discover(cls) -> List[type]:
      """è‡ªåŠ¨å‘ç° alphahome/features/recipes/ ä¸‹æ‰€æœ‰ Recipe ç±»

      è¯´æ˜ï¼šå®ç°ä¸Šæ¨èè¿”å›â€œRecipe ç±»ï¼ˆå¯å®ä¾‹åŒ–ï¼‰â€æˆ–â€œRecipe å•ä¾‹å¯¹è±¡ï¼ˆäºŒé€‰ä¸€ï¼‰â€ï¼Œä½†å¯¹å¤–è¡¨ç°åº”ç¨³å®šã€‚
      """
    
    @classmethod
    def get(cls, name: str) -> type:
      """æŒ‰åç§°è·å–ç‰¹å¾é…æ–¹ç±»"""
    
    @classmethod
    def list_all(cls) -> List[str]:
        """åˆ—å‡ºæ‰€æœ‰å·²æ³¨å†Œç‰¹å¾å"""
    
    # init/refresh/validate çš„ç¼–æ’å…¥å£å½“å‰ä»¥è„šæœ¬ä¸ºä¸»ï¼ˆè§ 3.3.3ï¼‰ã€‚
    # è‹¥åç»­éœ€è¦å¯¹å¤–æä¾›ç»Ÿä¸€ APIï¼Œå¯åœ¨ registry ä¸Šå±‚å¢åŠ  orchestration å±‚ï¼Œä½†é¿å…æŠŠ DB ä¾èµ–å¼•å…¥æ³¨å†Œè¡¨ã€‚
```

å®ç°æ–¹æ¡ˆï¼ˆå†™å…¥ä¸ºå·¥ç¨‹çº¦æŸï¼Œå‡å°‘åç»­åˆ†æ­§ï¼‰ï¼š

1) æ³¨å†Œæœºåˆ¶ï¼šè£…é¥°å™¨ + å¯¼å…¥å³æ³¨å†Œï¼ˆå¯¹é½ fetchersï¼‰
- çº¦æŸï¼šæ¯ä¸ª recipe æ–‡ä»¶åœ¨æ¨¡å—é¡¶å±‚ç”¨ `@feature_register()` æ³¨å†Œï¼ˆæ³¨å†Œå‘ç”Ÿåœ¨ import æ—¶ï¼‰ã€‚
- ç›®çš„ï¼šé¿å…åœ¨ `recipes/mv/__init__.py` é‡Œç»´æŠ¤è¶Šæ¥è¶Šé•¿çš„æ‰‹å·¥ import åˆ—è¡¨ã€‚
- å…¼å®¹æœŸï¼šå…è®¸ `recipes/mv/__init__.py` æš‚æ—¶ä¿ç•™å¯¼å‡ºï¼ˆè§ A6ï¼‰ï¼Œä½†æ–°å¢ recipe ä¸å†è¦æ±‚ä¿®æ”¹è¯¥æ–‡ä»¶ã€‚

2) Registry å­˜å‚¨å½¢æ€ï¼šå­˜â€œç±»â€ä¼˜å…ˆï¼Œé¿å…å­˜â€œå®ä¾‹â€
- æ¨èï¼š`FeatureRegistry` å­˜å‚¨â€œé…æ–¹ç±»â€ï¼ˆä¾‹å¦‚ `Type[BaseFeatureView]`ï¼‰ï¼Œéœ€è¦æ‰§è¡Œ create/refresh/validate æ—¶å†å®ä¾‹åŒ–ã€‚
- ç†ç”±ï¼š
  - é¿å… import æ—¶å°±åšé‡é€»è¾‘ï¼ˆä¾‹å¦‚è¯»å–é…ç½®/è¿æ¥ DBï¼‰ã€‚
  - æ›´æ¥è¿‘ fetchers çš„â€œæ³¨å†Œä»»åŠ¡ç±»â€æ¨¡å‹ï¼Œä¾¿äºæŒ‰éœ€æ„é€ ã€‚

3) discover çš„å®ç°ç­–ç•¥ï¼ˆ**é»˜è®¤é‡‡ç”¨åŠ¨æ€æ‰«æ**ï¼‰

> **å†³ç­–**ï¼šé»˜è®¤é‡‡ç”¨åŠ¨æ€æ‰«æï¼ˆæ–¹æ¡ˆ Bï¼‰ï¼Œä¸å†ç»´æŠ¤æ˜¾å¼å¯¼å…¥åˆ—è¡¨ã€‚

A. æ˜¾å¼å¯¼å…¥ï¼ˆå¤‡é€‰ï¼Œä¸é‡‡ç”¨ï¼‰
- `alphahome.features.recipes` åœ¨ `__init__.py` ä¸­æ˜¾å¼ import æ‰€æœ‰ recipe å­æ¨¡å—ï¼›import è§¦å‘æ³¨å†Œï¼›discover åªè¿”å› registry å†…å®¹ã€‚
- ä¼˜ç‚¹ï¼šè¡Œä¸ºç¡®å®šã€æ’é”™ç®€å•ã€‚
- ç¼ºç‚¹ï¼šæ–°å¢ recipe ä»éœ€è¦ç»´æŠ¤å¯¼å…¥åˆ—è¡¨ï¼ˆä¸ç¬¦åˆ"å…ç»´æŠ¤"ç›®æ ‡ï¼‰ã€‚
- ç»“è®ºï¼š**ä¸é‡‡ç”¨**ã€‚

B. åŠ¨æ€æ‰«æï¼ˆ**é»˜è®¤é‡‡ç”¨**ï¼‰
- `FeatureRegistry.discover()` ä½¿ç”¨ `pkgutil.walk_packages` æ‰«æ `alphahome.features.recipes` å­åŒ…ï¼ŒæŒ‰æ¨¡å—åæ’åºåé€ä¸ª importã€‚
- import è§¦å‘ `@feature_register()`ï¼›discover è¿”å› registry å†…å®¹ã€‚
- çº¦æŸï¼š
  - æ‰«æä»…åœ¨ scripts/å·¥å…·å…¥å£è°ƒç”¨ï¼Œä¸åœ¨ `alphahome.features` é¡¶å±‚ import æ—¶è‡ªåŠ¨è§¦å‘ã€‚
  - å¿…é¡»æä¾›ç¼“å­˜ï¼ˆä¾‹å¦‚ `_discovered` æ ‡å¿—ï¼‰ï¼Œå¹¶å…è®¸ `force_reload=True` ä¾›å¼€å‘è°ƒè¯•ã€‚
  - é‡åˆ°é‡å¤ `recipe.name` å¿…é¡»ç›´æ¥æŠ›é”™ï¼ˆFail Fastï¼‰ï¼Œé¿å…é™é»˜è¦†ç›–ã€‚

4) é”™è¯¯å¤„ç†ä¸å¯è§‚æµ‹æ€§
- é‡å¤æ³¨å†Œï¼šæŠ›å‡ºå¼‚å¸¸å¹¶æ‰“å°å†²çªæ¥æºï¼ˆmodule/classï¼‰ã€‚
- recipe å…ƒä¿¡æ¯ç¼ºå¤±ï¼šåœ¨æ³¨å†Œæ—¶æ ¡éªŒ `name/description/source_tables` ç­‰å…³é”®å­—æ®µï¼Œä¸æ»¡è¶³åˆ™æŠ¥é”™ã€‚
- discover å¯¼å…¥å¼‚å¸¸ï¼šé»˜è®¤æŠ›å‡ºï¼ˆé¿å…æ¼ç‰¹å¾ï¼‰ï¼›å¦‚éœ€â€œå®¹é”™æ¨¡å¼â€ï¼Œä»…å…è®¸åœ¨å¼€å‘ç¯å¢ƒæ˜¾å¼å¼€å¯ã€‚

5) ä¸ storage å±‚çš„è¾¹ç•Œ
- `BaseFeatureView.get_create_sql()` åªè´Ÿè´£å®šä¹‰å¯¹è±¡ï¼›æ‰§è¡Œ/åˆ·æ–°/æ ¡éªŒç”± `features/storage/` è´Ÿè´£ã€‚
- `BaseFeatureView.get_post_create_sqls()` ç”¨äºå£°æ˜â€œåˆ›å»ºå DDLâ€ï¼ˆä¾‹å¦‚ç´¢å¼•ï¼‰ï¼Œç”± `BaseFeatureView.create()` åœ¨ MV åˆ›å»ºæˆåŠŸåæ‰§è¡Œï¼Œæ¨èå¹‚ç­‰ï¼ˆ`IF NOT EXISTS`ï¼‰ã€‚
- `FeatureRegistry` æ˜¯â€œé…æ–¹å‘ç°ä¸ç¼–æ’å±‚â€ï¼Œä¸ç›´æ¥æŒæœ‰æ•°æ®åº“è¿æ¥æˆ–åœ¨ import é˜¶æ®µè§¦å‘æ•°æ®åº“æ“ä½œã€‚

#### 3.3.3 è¿ç»´è„šæœ¬å…¥å£

æ›¿ä»£ CLIï¼Œåœ¨ `scripts/` ä¸‹æä¾›æœ€å°åŒ–å…¥å£ï¼š

| è„šæœ¬ | åŠŸèƒ½ | ç¤ºä¾‹è°ƒç”¨ |
|------|------|----------|
| `scripts/features_init.py` | åˆå§‹åŒ– features schema å’Œæ‰€æœ‰ MV | `python scripts/features_init.py` |
| `scripts/features_refresh.py` | ï¼ˆè§„åˆ’ï¼‰åˆ·æ–°æŒ‡å®šæˆ–å…¨éƒ¨ç‰¹å¾ | - |
| `scripts/features_validate.py` | ï¼ˆè§„åˆ’ï¼‰æ ¡éªŒç‰¹å¾æ•°æ®è´¨é‡ | - |

### 3.4 æ•°æ®æµå‘

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        alphahome (ç”Ÿäº§è€…)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  fetchers/ â”€â”€â–º rawdata schema                                   â”‚
â”‚      â”‚                                                          â”‚
â”‚      â–¼                                                          â”‚
â”‚  research/pit_data/ â”€â”€â–º rawdata.pit_* tables (å½“å‰å®ç°)          â”‚
â”‚      â”‚                                                          â”‚
â”‚      â–¼                                                          â”‚
â”‚  features/pit/ â”€â”€â–º (è§„åˆ’) rawdata.pit_* tables                   â”‚
â”‚      â”‚                                                          â”‚
â”‚      â–¼                                                          â”‚
â”‚  features/storage/ â”€â”€â–º features schema (ç‰©åŒ–è§†å›¾)                â”‚
â”‚      â”‚                                                          â”‚
â”‚      â–¼                                                          â”‚
â”‚  features/recipes/mv/ â”€â”€â–º features.mv_*                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼ (alphadb)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      QuantLab (æ¶ˆè´¹è€…)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  data_infra/fetchers/ â—„â”€â”€ ä» alphadb è¯»å–ç¦»çº¿ç‰¹å¾               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. è¿ç§»æ–¹æ¡ˆ

é‡‡ç”¨**åŒçº¿å¹¶è¡Œ**ç­–ç•¥ï¼Œé™ä½é£é™©ã€‚

### 4.0 æ‰§è¡Œé¡ºåºï¼ˆæ¨èï¼‰

ä¸ºäº†æœ€å¤§ç¨‹åº¦é™ä½é£é™©ï¼Œå»ºè®®æŒ‰ä»¥ä¸‹é¡ºåºæ‰§è¡Œï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Phase 1: features åŸºç¡€è®¾æ–½å°±ç»ª                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                        â”‚
â”‚  A1-A7 â†’ è‡³å°‘ 1 ä¸ª MV å¯ init/create/refresh/validate          â”‚
â”‚  P1-P3 â†’ PIT æ¨¡å—è¿ç§»å®Œæˆ                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Phase 2: Barra è§£è€¦ï¼ˆä¸ Phase 1 å¯å¹¶è¡Œï¼‰                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                        â”‚
â”‚  B1-B5 â†’ scripts/tests æ—  processors.tasks.barra ä¾èµ–          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Phase 3: CLI ä¸‹çº¿ + processors æ¸…é›¶                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                        â”‚
â”‚  C1-C4 â†’ è¿ç»´ CLI å…¥å£å…¨éƒ¨ç§»é™¤                                  â”‚
â”‚  D1    â†’ grep ç¡®è®¤ 0 å¼•ç”¨                                       â”‚
â”‚  D2-D4 â†’ åˆ é™¤ processors ç›®å½•                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Phase 4: é¦–æ‰¹ç‰¹å¾å…¥åº“                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                        â”‚
â”‚  åŸºäºç”„åˆ«æ¸…å•ï¼Œé€æ‰¹è½åº“ valuation/breadth ç­‰ç‰¹å¾               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®æ£€æŸ¥ç‚¹**ï¼š
- Phase 1 å®Œæˆåï¼š`scripts/features_init.py` å¯æ‰§è¡Œï¼Œè‡³å°‘ 1 ä¸ª MV å¯åˆ·æ–°
- Phase 2 å®Œæˆåï¼š`scripts/run_barra_batch.py` å¯æ‰§è¡Œï¼Œæ—  processors import
- Phase 3 å®Œæˆåï¼šä»“åº“å†…æ— æ—§ processors æ®‹ç•™å¼•ç”¨ï¼ˆå»ºè®®ç”¨ PowerShellï¼š`Select-String -Path alphahome/**,scripts/**,tests/** -Pattern "processors." -SimpleMatch`ï¼›å¦‚å®‰è£…äº† ripgrep/grep ä¹Ÿå¯ç”¨ï¼š`rg "processors\." alphahome scripts tests`ï¼‰

### 4.1 Line A: ç‰©åŒ–è§†å›¾ â†’ features/storage

**ç›®æ ‡**: æŠŠç‰©åŒ–è§†å›¾å­ç³»ç»Ÿè¿ç§»åˆ° features/storageï¼Œä½œä¸ºç‰¹å¾å­˜å‚¨çš„ä¸»å®ç°æ–¹å¼ã€‚

| é˜¶æ®µ | ä»»åŠ¡ | äº§å‡º | éªŒæ”¶æ ‡å‡† |
|------|------|------|----------|
| A1 | åˆ›å»º `features/storage/` ç›®å½•ç»“æ„ | ç©ºæ¨¡å—éª¨æ¶ | import ä¸æŠ¥é”™ |
| A2 | è¿ç§» `sql_templates.py` | PIT/èšåˆæ¨¡æ¿å¯ç”¨ | å•æµ‹é€šè¿‡ |
| A3 | è¿ç§» `refresh.py` + `validator.py` | åˆ·æ–°ä¸æ ¡éªŒå¯ç”¨ | æ‰‹åŠ¨éªŒè¯ |
| A4 | è¿ç§» `database_init.py` | schema åˆå§‹åŒ–å¯ç”¨ | `features` schema å¯åˆ›å»º |
| A5 | è¿ç§» `base_task.py` â†’ `base_view.py` | å»é™¤å¯¹ ProcessorTaskBase çš„ä¾èµ– | ç‹¬ç«‹è¿è¡Œ |
| A6 | è¿ç§»"è§†å›¾å®šä¹‰"åˆ° `features/recipes/mv/{domain}/`ï¼ˆå‚è§ Section 2.3 MV å®šä¹‰æ¸…å•ï¼Œå…± 4 ä¸ªï¼‰ | è§†å›¾å®šä¹‰ç±»/SQL ç”Ÿæˆå‡½æ•° | è‡³å°‘ 1 ä¸ªè§†å›¾å¯åˆ›å»º+åˆ·æ–° |
| A7 | æ›´æ–° `scripts/initialize_materialized_views.py` | æ”¹ä¸º import features | è„šæœ¬å¯æ‰§è¡Œ |

è¡¥å……çº¦æŸï¼ˆA6 çš„è½åœ°è§„èŒƒï¼‰ï¼š
1. è¿ç§»æ—¶å¿…é¡»éµå®ˆ Section 3.2.1 çš„å‘½åä¸‰ä»¶å¥—ï¼ˆæ–‡ä»¶å / ç±»å / recipe.nameï¼‰ä¸è¾“å‡ºè¡¨å‘½åè§„åˆ™ã€‚
2. è¿ç§»æ—¶æŒ‰ä¸šåŠ¡åŸŸåˆ†ç»„è½ä½ï¼š
  - stock ç±» MVï¼ˆå¯åŒ…å« PIT æ—¶é—´çª—å£/å®‰å…¨è¯­ä¹‰ï¼‰â†’ `features/recipes/mv/stock/`
    - market ç±» MV â†’ `features/recipes/mv/market/`
3. å‘½åå˜æ›´ä¸å…¼å®¹ï¼š
  - è‹¥éœ€è¦é‡å‘½åï¼ˆä¾‹å¦‚ä» `pit_*` è¿ç§»åˆ° `stock_*`ï¼‰ï¼Œåº”è§†ä¸ºç ´åæ€§å˜æ›´ï¼šç»Ÿä¸€æ›´æ–°è°ƒç”¨æ–¹ä¸æµ‹è¯•ï¼Œå¹¶åŒæ­¥æ›´æ–°è½åº“å¯¹è±¡å‘½åã€‚
4. è·¯å¾„è¿ç§»ä¸åº”æ”¹å˜ `recipe.name`ï¼š
    - `recipe.name` æ˜¯ä¸‹æ¸¸å¥‘çº¦ï¼ˆå¡ç‰‡ã€è¾“å‡ºè¡¨åã€refresh/validate æŒ‡ä»¤å…¥å‚çš„åŸºç¡€ï¼‰ï¼Œè¿ç§»ç›®å½•ç»“æ„æ—¶å¿…é¡»ä¿æŒä¸å˜ã€‚

### 4.2 Line B: Barra è„šæœ¬è§£è€¦

**ç›®æ ‡**: æŠŠ Barra ç›¸å…³è„šæœ¬ä» `processors/tasks/barra/` è§£è€¦ï¼Œæ”¹ä¸ºç›´æ¥è°ƒç”¨ `alphahome/barra/`ã€‚

è¯´æ˜ï¼šè¿™æ¡çº¿ä¸å±äº features å»ºè®¾å†…å®¹ï¼Œä½†å®ƒæ˜¯åˆ é™¤ processors çš„ç¡¬å‰ç½®ã€‚

| é˜¶æ®µ | ä»»åŠ¡ | äº§å‡º | éªŒæ”¶æ ‡å‡† |
|------|------|------|----------|
| B1 | åˆ†æ `processors/tasks/barra/` ä¸ `alphahome/barra/` çš„å·®å¼‚ | å·®å¼‚æ¸…å• | æ–‡æ¡£åŒ– |
| B2 | è¡¥å…¨ `alphahome/barra/` ç¼ºå¤±çš„å…¥å£å‡½æ•° | å¯ç‹¬ç«‹è°ƒç”¨ | æ—  processors ä¾èµ– |
| B3 | æ›´æ–° `scripts/run_barra_batch.py` | æ”¹ä¸º import barra | è„šæœ¬å¯æ‰§è¡Œ |
| B4 | æ›´æ–° `scripts/debug_run_barra_day.py` | åŒä¸Š | è„šæœ¬å¯æ‰§è¡Œ |
| B5 | æ›´æ–° `tests/unit/test_barra/test_wls_regression.py`ï¼ˆå¹¶æ ¸å¯¹ Barra å•æµ‹ä¸ä¾èµ– processorsï¼‰ | æ”¹ä¸º import barra | pytest é€šè¿‡ |

### 4.3 å» CLI

**ç›®æ ‡**: ç§»é™¤æ‰€æœ‰ CLI å…¥å£ï¼ˆè¿ç»´/ç”Ÿäº§å‘½ä»¤è¡Œï¼‰ï¼Œç­‰ features ç¨³å®šåå†è€ƒè™‘æ¢å¤ã€‚

| é˜¶æ®µ | ä»»åŠ¡ | äº§å‡º | éªŒæ”¶æ ‡å‡† |
|------|------|------|----------|
| C1 | ä» `pyproject.toml` ç§»é™¤ `refresh-materialized-view` å…¥å£ç‚¹ | æ— è¯¥å…¥å£ | `pip install -e .` ä¸æŠ¥é”™ |
| C2 | ä» `pyproject.toml` ç§»é™¤ `ah`/`alphahome-cli` å…¥å£ç‚¹ | æ— ç»Ÿä¸€ CLI | `pip install -e .` ä¸æŠ¥é”™ |
| C3 | ï¼ˆå¯é€‰ï¼‰ä» `pyproject.toml` ç§»é™¤ `alphahome-ddb` å…¥å£ç‚¹ | æ—  DDB CLI | `pip install -e .` ä¸æŠ¥é”™ |
| C4 | ç§»é™¤ `alphahome/cli/` å­åŒ…ï¼ˆæˆ–æœ€å°åŒ–ä¸ºç©ºå£³ï¼‰ | æ—  cli ä¾èµ– | import ä¸æŠ¥é”™ |

æ›¿ä»£æ–¹å¼ï¼š
- è¿ç»´ä¸ç”Ÿäº§åŠ¨ä½œä»¥ `scripts/*.py` æˆ– Python API æ–¹å¼æ‰§è¡Œï¼ˆä¾‹å¦‚åˆå§‹åŒ– features schemaã€åˆ·æ–°æŒ‡å®š MVï¼‰ã€‚

### 4.4 åˆ é™¤ processors

**ç›®æ ‡**: ç¡®è®¤æ— å¤–éƒ¨ä¾èµ–åï¼Œåˆ é™¤æ•´ä¸ª processors ç›®å½•ã€‚

| é˜¶æ®µ | ä»»åŠ¡ | äº§å‡º | éªŒæ”¶æ ‡å‡† |
|------|------|------|----------|
| D1 | å…¨å±€ grep ç¡®è®¤æ— æ—§ processors æ®‹ç•™å¼•ç”¨ | æ¸…é›¶æŠ¥å‘Š | 0 åŒ¹é… |
| D2 | åˆ é™¤ `alphahome/processors/` ç›®å½• | ç›®å½•ä¸å­˜åœ¨ | - |
| D3 | ä» `alphahome/__init__.py` ç§»é™¤ processors å¯¼å‡º | æ— å¯¼å‡º | import ä¸æŠ¥é”™ |
| D4 | æ›´æ–°æ–‡æ¡£ï¼ˆREADMEã€docs/ï¼‰| ç§»é™¤ processors ç›¸å…³æè¿° | æ–‡æ¡£ä¸€è‡´ |

å›æ»šç­–ç•¥ï¼ˆå»ºè®®æ˜ç¡®ï¼‰ï¼š
- åœ¨ D2 å‰ä¿ç•™ä¸€ä¸ªçŸ­æœŸå…¼å®¹å±‚ï¼ˆä¾‹å¦‚å°†æ—§è·¯å¾„ re-export åˆ°æ–°è·¯å¾„ï¼‰ï¼Œä»¥ä¾¿é€æ­¥æ›¿æ¢ scripts/tests çš„ importï¼›å½“ D1 æ¸…é›¶åå†åˆ é™¤ã€‚

---

## 5. ç‰¹å¾ç”„åˆ«æ¸…å•ï¼ˆæµç¨‹åŒ–æ–¹æ¡ˆï¼‰

> **ç”„åˆ«æ˜¯æœ¬æ¨¡å—æœ€æ ¸å¿ƒçš„ä»·å€¼ç‚¹ã€‚** alphahome æ˜¯ alphadb çš„ "ç”Ÿäº§è€…"ï¼ŒQuantLab/data_infra æ˜¯ "æ¶ˆè´¹è€…"ã€‚
> è½åº“å‰å¿…é¡»å®Œæˆå®Œæ•´çš„ç”„åˆ«æµç¨‹ï¼Œé¿å…æŠŠ QuantLab ç«¯ä¸´æ—¶è¯•éªŒçš„ Fetcher ç›²ç›®æ¬è¿åˆ° alphahomeã€‚

### 5.1 å…«æ­¥ç”„åˆ«æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç‰¹å¾å…¥åº“ç”„åˆ«æµç¨‹ï¼ˆ8 æ­¥ï¼‰                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ Step 1  â”‚â”€â”€â”€>â”‚ Step 2  â”‚â”€â”€â”€>â”‚ Step 3  â”‚â”€â”€â”€>â”‚ Step 4  â”‚                  â”‚
â”‚  â”‚å€™é€‰æå â”‚    â”‚è¾“å…¥è¡¨æ˜ å°„â”‚    â”‚æ—¶é—´è¯­ä¹‰ â”‚    â”‚PITå®‰å…¨  â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚       â”‚                                              â”‚                      â”‚
â”‚       v                                              v                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ Step 8  â”‚<â”€â”€â”€â”‚ Step 7  â”‚<â”€â”€â”€â”‚ Step 6  â”‚<â”€â”€â”€â”‚ Step 5  â”‚                  â”‚
â”‚  â”‚å…¥åº“å¡ç‰‡ â”‚    â”‚ä¸‹æ¸¸éªŒè¯ â”‚    â”‚è½åº“å½¢æ€ â”‚    â”‚è´¨é‡è§„åˆ™ â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| æ­¥éª¤ | åç§° | å¿…é¡»å›ç­”çš„é—®é¢˜ | äº§å‡º |
|------|------|----------------|------|
| 1 | **å€™é€‰æå** | è°æåï¼Ÿè§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿå·²æœ‰å¤šå°‘ç­–ç•¥å¤ç”¨ï¼Ÿ | æåè¡¨å• |
| 2 | **è¾“å…¥è¡¨æ˜ å°„** | ä¾èµ– alphadb å“ªäº› schema/è¡¨ï¼Ÿraw or cleanï¼Ÿ | ä¾èµ–è¡¨æ¸…å• |
| 3 | **æ—¶é—´è¯­ä¹‰** | trade_date / ann_date / end_dateï¼Ÿé¢‘ç‡ï¼Ÿ | æ—¶é—´å­—æ®µè§„èŒƒ |
| 4 | **PIT å®‰å…¨** | æ˜¯å¦å­˜åœ¨æœªæ¥ä¿¡æ¯ï¼Ÿavailable lag å¤šå°‘å¤©ï¼Ÿ | PIT å®‰å…¨å£°æ˜ |
| 5 | **è´¨é‡è§„åˆ™** | ç¼ºå¤±ç‡é˜ˆå€¼ï¼ŸèŒƒå›´æ ¡éªŒï¼Ÿå”¯ä¸€æ€§ï¼Ÿ | è´¨é‡è§„åˆ™ YAML |
| 6 | **è½åº“å½¢æ€** | ç‰©åŒ–è§†å›¾ / æ™®é€šè¡¨ / PIT è¡¨ï¼Ÿåˆ·æ–°ç­–ç•¥ï¼Ÿ | è½åº“æ–¹æ¡ˆ |
| 7 | **ä¸‹æ¸¸éªŒè¯** | data_infra å¯¹åº” Fetcher èƒ½å¦æ— ç¼åˆ‡æ¢ï¼Ÿ | éªŒè¯è„šæœ¬ |
| 8 | **å…¥åº“å¡ç‰‡** | æ±‡æ€»æ‰€æœ‰ä¿¡æ¯ï¼Œå½¢æˆå¯è¿½æº¯çš„å…¥åº“è®°å½• | YAML å¡ç‰‡ |

### 5.2 å…¥åº“å¡ç‰‡æ¨¡æ¿ï¼ˆYAMLï¼‰

æ¯ä¸ªå¾…å…¥åº“ç‰¹å¾å¿…é¡»æäº¤ä»¥ä¸‹å¡ç‰‡ï¼Œå­˜æ”¾äº `alphahome/features/cards/<feature_name>.yaml`ï¼š

```yaml
# ç‰¹å¾å…¥åº“å¡ç‰‡
feature_name: valuation_daily
version: 1.0.0
created_by: <author>
created_at: <date>
status: pending  # pending | approved | rejected | deprecated

# Step 2: è¾“å…¥è¡¨æ˜ å°„
source_tables:
  - schema: rawdata
    table: stk_valuation_daily
    key_columns: [stock_code, trade_date]

# Step 3: æ—¶é—´è¯­ä¹‰
timestamp:
  field: trade_date
  semantic: trading_day  # trading_day | announcement_date | report_end_date
  frequency: daily       # daily | weekly | monthly | quarterly

# Step 4: PIT å®‰å…¨
pit_safety:
  has_future_info: false
  available_lag_days: 0
  notes: "ä¼°å€¼æŒ‡æ ‡å½“æ—¥æ”¶ç›˜åå¯å¾—"

# Step 5: è´¨é‡è§„åˆ™
quality_checks:
  - type: null_rate
    column: pe_ttm
    threshold: 0.05
  - type: range
    column: pe_ttm
    min: -1000
    max: 10000
  - type: uniqueness
    columns: [stock_code, trade_date]

# Step 6: è½åº“å½¢æ€
output:
  type: materialized_view  # materialized_view | table | pit_table
  schema: features
  name: mv_valuation_daily
  refresh: daily
  depends_on_mv: []

# Step 7: ä¸‹æ¸¸éªŒè¯
downstream_verification:
  quantlab_fetcher: valuation
  test_script: tests/features/test_valuation_parity.py
  expected_diff: 0

# å®¡æ‰¹è®°å½•
approval:
  reviewer: null
  reviewed_at: null
  comments: null
```

### 5.3 å†³ç­–æ ‘

```
æ˜¯å¦åº”å…¥åº“ï¼Ÿ
â”‚
â”œâ”€â”€ å£å¾„æ˜¯å¦ç¨³å®šï¼Ÿ
â”‚   â””â”€â”€ å¦ â†’ ä¸å…¥åº“ï¼ˆä¿ç•™ QuantLabï¼‰
â”‚
â”œâ”€â”€ æ˜¯å¦è·¨ç­–ç•¥å¤ç”¨ï¼Ÿ
â”‚   â””â”€â”€ å¦ â†’ è¯„ä¼°åå†³å®š
â”‚
â”œâ”€â”€ è®¡ç®—æˆæœ¬æ˜¯å¦é«˜ï¼Ÿ
â”‚   â””â”€â”€ æ˜¯ â†’ ä¼˜å…ˆå…¥åº“
â”‚
â”œâ”€â”€ PIT è¯­ä¹‰æ˜¯å¦æ¸…æ™°ï¼Ÿ
â”‚   â””â”€â”€ å¦ â†’ éœ€è¯„å®¡
â”‚
â””â”€â”€ ä»¥ä¸Šå‡æ»¡è¶³ â†’ å…¥åº“
```

### 5.4 data_infra Fetcher ç”„åˆ«çŠ¶æ€

> ä»¥ä¸‹ä¸º data_infra 34 ä¸ª Fetcher çš„å®Œæ•´ç”„åˆ«æ¸…å•ï¼ˆ2026-01-30 æ›´æ–°ï¼‰ã€‚  
> **ç”„åˆ«çŠ¶æ€**ï¼šâ¬œ æœªå¼€å§‹ | ğŸŸ¡ è¿›è¡Œä¸­ | âœ… å·²å…¥åº“ | âŒ ä¸å…¥åº“ | ğŸ”µ éœ€è¯„å®¡

---

#### ç¬¬ä¸€æ‰¹ï¼šæ¨èä¼˜å…ˆå…¥åº“ï¼ˆå£å¾„ç¨³å®šã€è·¨ç­–ç•¥å¤ç”¨ã€PIT å®‰å…¨ï¼‰

| Fetcher | è¾“å‡ºç‰¹å¾ | ä¾èµ–è¡¨ | æ—¶é—´è¯­ä¹‰ | PIT å®‰å…¨ | ç”„åˆ«çŠ¶æ€ | å…¥åº“å¡ç‰‡ |
|---------|----------|--------|----------|----------|----------|----------|
| `valuation` | PE/PB åˆ†ä½æ•°ã€ERP | tushare.index_dailybasic, akshare.macro_bond_rate | trade_date (æ—¥) | âœ… æ— æœªæ¥ä¿¡æ¯ï¼ˆæ”¶ç›˜åå¯å¾—ï¼‰ | âœ… | index_features_daily |
| `market_breadth` | MA60/MA90 å æ¯”ã€æ¶¨è·Œåœæ¯” | tushare.stock_factor_pro, tushare.stock_limitlist | trade_date (æ—¥) | âœ… æ— æœªæ¥ä¿¡æ¯ | âœ… | market_sentiment_daily |
| `new_high_new_low_diff` | 52 å‘¨æ–°é«˜æ–°ä½æ¯” | tushare.stock_factor_pro | trade_date (æ—¥) | âœ… æ— æœªæ¥ä¿¡æ¯ | âœ… | market_sentiment_daily |
| `margin` | èèµ„ä½™é¢å æµé€šå¸‚å€¼æ¯” | tushare.stock_margin, tushare.stock_dailybasic | trade_date (æœˆæœ«) | âœ… æ— æœªæ¥ä¿¡æ¯ | âœ… | market_margin_monthly |
| `margin_turnover_ratio` | ä¸¤èæˆäº¤å æ¯” | tushare.stock_margin, tushare.stock_daily | trade_date (æ—¥) | âœ… æ— æœªæ¥ä¿¡æ¯ | âœ… | margin_turnover_daily |
| `index_volatility` | æŒ‡æ•°å®ç°æ³¢åŠ¨ç‡ 20/60/252D | tushare.index_factor_pro | trade_date (æ—¥) | âœ… æ— æœªæ¥ä¿¡æ¯ | âœ… | index_features_daily |
| `volatility_acceleration` | æ³¢åŠ¨ç‡åŠ é€Ÿåº¦ | tushare.index_factor_pro | trade_date (æ—¥) | âœ… æ— æœªæ¥ä¿¡æ¯ | âœ… | index_features_daily |
| `index_fundamental` | æŒ‡æ•°åŠ æƒ PE/PB (PIT æƒé‡) | tushare.index_weight, tushare.stock_dailybasic | trade_date (æ—¥) | âœ… PIT æƒé‡å·²å®ç° | âœ… | index_fundamental_daily |
| `macro_bond_rate` | ä¸­ç¾å›½å€ºæ”¶ç›Šç‡ã€æœŸé™åˆ©å·® | akshare.macro_bond_rate | trade_date (æ—¥) | âœ… æ— æœªæ¥ä¿¡æ¯ | âœ… | macro_rate_daily |
| `macro_rate_percentile` | åˆ©ç‡å†å²åˆ†ä½æ•° | akshare.macro_bond_rate | trade_date (æ—¥) | âœ… æ— æœªæ¥ä¿¡æ¯ | âœ… | macro_rate_daily |
| `market_technical` | å¸‚åœºåŠ¨é‡/æ³¢åŠ¨/é‡ä»·åˆ†å¸ƒ | tushare.stock_factor_pro | trade_date (æ—¥) | âœ… æ— æœªæ¥ä¿¡æ¯ | âœ… | market_technical_daily |
| `market_return_distribution` | å…¨å¸‚åœºæ¶¨è·Œåˆ†å¸ƒ | tushare.stock_factor_pro | trade_date (æ—¥) | âœ… æ— æœªæ¥ä¿¡æ¯ | âœ… | market_technical_daily |
| `limit_updown_features` | æ¶¨è·Œåœå®¶æ•°/è¿æ¿/ç‚¸æ¿ | tushare.stock_limitlist, tushare.stock_st | trade_date (æ—¥) | âœ… æ— æœªæ¥ä¿¡æ¯ | âœ… | market_sentiment_daily |
| `industry_return` | ç”³ä¸‡äºŒçº§è¡Œä¸šæ—¥æ”¶ç›Š | tushare.index_swdaily | trade_date (æ—¥) | âœ… æ— æœªæ¥ä¿¡æ¯ | âœ… | industry_features_daily |
| `industry_breadth` | è¡Œä¸šå®½åº¦/åˆ†æ•£åº¦ï¼ˆç”³ä¸‡äºŒçº§ï¼‰ | tushare.index_swdaily | trade_date (æ—¥) | âœ… æ— æœªæ¥ä¿¡æ¯ | âœ… | industry_features_daily |
| `index_boll_signals` | å¸ƒæ—å¸¦çªç ´ä¿¡å· | tushare.index_factor_pro | trade_date (æ—¥) | âœ… æ— æœªæ¥ä¿¡æ¯ | âœ… | index_technical_daily |
| `index_ma120_distance` | MA120 åç¦»åº¦ | tushare.index_factor_pro | trade_date (æ—¥) | âœ… æ— æœªæ¥ä¿¡æ¯ | âœ… | index_technical_daily |
| `etf_flow` | ETF å‡€ç”³èµèµ„é‡‘æµ | tushare.fund_share, tushare.fund_nav, tushare.fund_etf_basic | trade_date (æ—¥) | âœ… æ— æœªæ¥ä¿¡æ¯ | âœ… | etf_flow_daily |
| `style_index_return` | é£æ ¼æŒ‡æ•°æ”¶ç›Š | tushare.index_factor_pro | trade_date (æ—¥) | âœ… æ— æœªæ¥ä¿¡æ¯ | âœ… | style_features_daily |
| `style_momentum` | é£æ ¼ç›¸å¯¹å¼ºå¼± | tushare.index_factor_pro | trade_date (æ—¥) | âœ… æ— æœªæ¥ä¿¡æ¯ | âœ… | style_features_daily |

---

#### ç¬¬äºŒæ‰¹ï¼šè¯„å®¡å®Œæˆï¼ˆ2026-01-30ï¼‰

> è¯¦ç»†è¯„å®¡æŠ¥å‘Šï¼š[docs/tasks/M7_fetchers_review_phase2.md](../tasks/M7_fetchers_review_phase2.md)

| Fetcher | è¯„å®¡ç»“è®º | ç†ç”± | ç”„åˆ«çŠ¶æ€ |
|---------|----------|------|----------|
| `money_flow` | **å…¥åº“** | å£å¾„æ¸…æ™°ï¼ˆå°å•<5ä¸‡/ä¸­å•5-20ä¸‡/å¤§å•20-100ä¸‡/ç‰¹å¤§å•â‰¥100ä¸‡ï¼‰ï¼›å­—æ®µå®Œæ•´ï¼ˆsm/md/lg/elg ä¹°å–é‡ä»·ï¼‰ï¼›2010å¹´èµ·å¯ç”¨ | âœ… money_flow_daily |
| `futures_basis` | **å…¥åº“** | å£å¾„æ¸…æ™°ï¼ˆåŠ æƒåŸºå·®ï¼‰ï¼›ä¾èµ–è¡¨å·²æœ‰ | âœ… futures_features_daily |
| `member_position` | **å…¥åº“** | ä¼šå‘˜æŒä»“å‡€å¤šç©º/å¤šç©ºæ¯”ï¼›future_holding å¯ç”¨ | âœ… futures_features_daily |
| `pcr_weekly` | ä¿ç•™è¯„å®¡ | å‘¨é¢‘ï¼›ETF æœŸæƒè¦†ç›–ç‡å¾…éªŒè¯ | ğŸ”µ |
| `option_iv` | ä¸å…¥åº“ | å¼ºä¾èµ– scipyï¼›BS åæ¨æç«¯ NaN å¤šï¼›è®¡ç®—åº”ç•™æ¶ˆè´¹ç«¯ | âŒ |
| `iv_term_structure` | ä¸å…¥åº“ | ä¾èµ– option_ivï¼›å åŠ å¤æ‚åº¦ | âŒ |
| `rsrs` | ä¸å…¥åº“ | æ‹©æ—¶ä¿¡å·éç‰¹å¾ï¼›å‚æ•°æ•æ„Ÿï¼ˆ18/600 çª—å£ï¼‰ | âŒ |
| `market_industry_flow` | ä¿ç•™è¯„å®¡ | ä¸ industry_features_daily åŠŸèƒ½é‡å å¾…è¯„ä¼° | ğŸ”µ |
| `cb_risk_appetite` | ä¿ç•™è¯„å®¡ | cbond_daily è¦†ç›–ç‡å¾…éªŒè¯ï¼ˆ2020 åæ•°æ®è¾ƒå…¨ï¼‰ | ğŸ”µ |
| `st_risk_appetite` | **å…¥åº“** | stock_st åŠ¨æ€åˆ—è¡¨é¿å…å¹¸å­˜è€…åå·®ï¼›2016-08 èµ·å¯ç”¨ | âœ… risk_appetite_daily |
| `bse_risk_appetite` | **å…¥åº“** | åŒ—äº¤æ‰€ 2021-11 å¼€å¸‚ï¼›æ•°æ®å®Œæ•´ | âœ… risk_appetite_daily |
| `microcap_risk_appetite` | ä¿ç•™è¯„å®¡ | "å¾®ç›˜è‚¡"å£å¾„éœ€ç¡®è®¤ï¼ˆå 10% or å›ºå®šé˜ˆå€¼ï¼‰ | ğŸ”µ |
| `risk_appetite_composite` | ä¸å…¥åº“ | ç»„åˆæƒé‡ä¸å®œå›ºåŒ–ï¼›åº”è½åŸå­æŒ‡æ ‡ | âŒ |
| `index_factor_pro` | ä¸å…¥åº“ | æºè¡¨å·²è½åº“ï¼ˆtushare.index_factor_proï¼‰ï¼›æ— å¢é‡ä»·å€¼ | âŒ |
| `market_valuation_distribution` | **å…¥åº“** | PE/PB åˆ†å¸ƒï¼›ä¸ market_stats äº’è¡¥ | âœ… market_stats æˆ–ç‹¬ç«‹ |
| `market_turnover_distribution` | **å…¥åº“** | æ¢æ‰‹ç‡åˆ†å¸ƒ/æˆäº¤é›†ä¸­åº¦ | âœ… market_technical_daily |
| `market_momentum_distribution` | **å…¥åº“** | RSI/MA åˆ†å¸ƒ | âœ… market_technical_daily |
| `market_size_dispersion` | **å…¥åº“** | å¤§å°ç›˜æ”¶ç›Šå·®ï¼›ç‹¬ç«‹æŒ‡æ ‡ | âœ… market_size_daily |
| `market_volatility_distribution` | **å…¥åº“** | ATR/æŒ¯å¹…åˆ†å¸ƒ | âœ… market_technical_daily |
| `repurchase_weekly` | **å…¥åº“** | è‚¡ç¥¨å›è´­å‘¨é¢‘èšåˆï¼ˆå…¬å‘Šæ•°/é‡‘é¢/è¿›åº¦åˆ†å¸ƒï¼‰ï¼›2010å¹´èµ·å¯ç”¨ | âœ… repurchase_weekly |
| `holdertrade_weekly` | **å…¥åº“** | è‚¡ä¸œå¢å‡æŒå‘¨é¢‘ï¼ˆé«˜ç®¡/å…¬å¸/ä¸ªäººåˆ†å±‚ï¼‰ï¼›é•¿æœŸå¯ç”¨ | âœ… holdertrade_weekly |
| `limit_industry_distribution` | **å…¥åº“** | æ¶¨è·Œåœè¡Œä¸šåˆ†å¸ƒï¼ˆHHI/Topè¡Œä¸šå æ¯”ï¼‰ï¼›æ—¥é¢‘ | âœ… limit_industry_daily |

---

#### ä¸å…¥åº“ï¼ˆä¿ç•™ QuantLab ç«¯æ¶ˆè´¹ï¼‰

| Fetcher | åŸå›  | ç”„åˆ«çŠ¶æ€ |
|---------|------|----------|
| `dragon_tiger` | ç¨€ç–äº‹ä»¶æ•°æ®ï¼ˆæ—¥è¦†ç›– <1%ï¼‰ï¼Œå£å¾„ä¸ç¨³ | âŒ |
| `dragon_tiger_inst` | åŒä¸Š | âŒ |
| `blocktrade` | ç¨€ç–äº‹ä»¶æ•°æ®ï¼ˆæ—¥è¦†ç›– <1%ï¼‰ï¼ŒæŠ˜æº¢ä»·å£å¾„å¤šå˜ | âŒ |
| `analyst_revision` | å¼ºä¾èµ–å¤–éƒ¨é¢„æœŸæ•°æ®ï¼Œå£å¾„éšåˆ¸å•†å˜åŒ– | âŒ |
| `consensus_eps` | åŒä¸Š | âŒ |
| `rating_momentum` | åŒä¸Š | âŒ |
| `global_index` | å¤–éƒ¨æ•°æ®æºï¼ˆé alphadb èŒƒç•´ï¼‰ï¼Œè·¨å¸‚åœºæ—¶åŒºå¤æ‚ | âŒ |
| `global_index_momentum` | åŒä¸Š | âŒ |
| `option_iv` | å¼ºä¾èµ– scipyï¼›è®¡ç®—åº”ç•™æ¶ˆè´¹ç«¯ | âŒ |
| `iv_term_structure` | ä¾èµ– option_iv | âŒ |
| `rsrs` | æ‹©æ—¶ä¿¡å·éç‰¹å¾ | âŒ |
| `risk_appetite_composite` | ç»„åˆæƒé‡ä¸å®œå›ºåŒ– | âŒ |
| `index_factor_pro` | æºè¡¨å·²è½åº“ï¼›æ— å¢é‡ä»·å€¼ | âŒ |

---

#### ç»Ÿè®¡æ±‡æ€»ï¼ˆ2026-01-30 æ›´æ–°ï¼‰

| ç±»åˆ« | æ•°é‡ |
|------|------|
| âœ… å·²å…¥åº“ | 20 + 11 + 3 = **34** |
| ğŸ”µ ä¿ç•™è¯„å®¡ | 5 |
| âŒ ä¸å…¥åº“ | 8 + 5 = **13** |
| **åˆè®¡** | **52**ï¼ˆå«å­ Fetcherï¼‰ |

### 5.5 ç”„åˆ«æ²»ç†æœºåˆ¶

1. **å¡ç‰‡é©±åŠ¨**ï¼šæ— å¡ç‰‡ = ä¸å…¥åº“ã€‚æ‰€æœ‰ç‰¹å¾å¿…é¡»æœ‰å¯è¿½æº¯çš„ YAML å¡ç‰‡ã€‚
2. **ç‰ˆæœ¬æ§åˆ¶**ï¼šå¡ç‰‡éšä»£ç ä¸€èµ· Git ç®¡ç†ï¼Œå˜æ›´éœ€ PR è¯„å®¡ã€‚
3. **çŠ¶æ€æµè½¬**ï¼š`pending â†’ approved â†’ (deprecated)`ï¼Œrejected çš„å¡ç‰‡ä¿ç•™ä½†ä¸æ¿€æ´»ã€‚
4. **å®šæœŸå®¡è®¡**ï¼šæ¯å­£åº¦å®¡è®¡ä¸€æ¬¡å·²å…¥åº“ç‰¹å¾çš„ä½¿ç”¨ç‡ï¼Œä½ä½¿ç”¨ç‡ç‰¹å¾æ ‡è®° deprecatedã€‚

---

## 6. PIT æ•°æ®è¿ç§»

### 6.1 ç°çŠ¶

| æ¨¡å— | ä½ç½® | çŠ¶æ€ |
|------|------|------|
| PITTableManager | `research/pit_data/base/pit_table_manager.py` | ç”Ÿäº§å¯ç”¨ |
| pit_balance_quarterly | `research/pit_data/pit_balance_quarterly_manager.py` | ç”Ÿäº§å¯ç”¨ |
| pit_income_quarterly | `research/pit_data/pit_income_quarterly_manager.py` | ç”Ÿäº§å¯ç”¨ |
| pit_financial_indicators | `research/pit_data/pit_financial_indicators_manager.py` | ç”Ÿäº§å¯ç”¨ |
| pit_industry_classification | `research/pit_data/pit_industry_classification_manager.py` | ç”Ÿäº§å¯ç”¨ |

### 6.2 è¿ç§»è®¡åˆ’

æœ¬é¡¹ç›®**ä¸å†æ‰§è¡Œ**â€œæŠŠ `research/pit_data/` ä»£ç è¿ç§»è¿› `features/pit/`â€çš„åŸè®¡åˆ’ï¼ˆP1-P5ï¼‰ã€‚

æ”¹ä¸ºé‡‡ç”¨ **æ–¹æ¡ˆ Dï¼šMV PIT åŒ–æ›¿ä»£**ï¼š

- **å®šä½è°ƒæ•´**ï¼šPIT æ˜¯æ—¶é—´è¯­ä¹‰/å®‰å…¨åŸåˆ™ï¼Œè€Œä¸æ˜¯å¿…é¡»ç‹¬ç«‹ç»´æŠ¤çš„ä¸€å¥—â€œPIT è¡¨ç”Ÿäº§ç®¡é“â€ã€‚
- **è½åœ°æ–¹å¼**ï¼šä»¥ `features` schema ä¸‹çš„ `mv_*` ç‰©åŒ–è§†å›¾ä½œä¸ºå¯¹å¤–ç¨³å®šå¥‘çº¦ï¼Œç›´æ¥æä¾›å¯ PIT æ¶ˆè´¹çš„æ—¶é—´çª—å£å­—æ®µã€‚
- **å–èˆ**ï¼š
  - `research/pit_data/` ç»§ç»­ä¿ç•™ä¸ºå†å²å®ç°ä¸ç ”ç©¶å·¥å…·é“¾ï¼ˆå¿…è¦æ—¶ç”¨äºå¯¹æ¯”ä¸å›æ»šï¼‰ã€‚
  - `features/pit/` ä¿æŒå ä½ï¼ˆä¸å†ä½œä¸ºè¿‘æœŸäº¤ä»˜ç›®æ ‡ï¼‰ï¼Œé¿å…å¼•å…¥èŒè´£è¾¹ç•Œä¸ schema è¯­ä¹‰æ··ä¹±ã€‚

#### 6.2.1 ä¸‹ä¸€æ­¥è®¡åˆ’ï¼ˆæ–°å¢ income/balance æ´¾ç”Ÿ MVï¼‰

åœ¨ç°æœ‰ `features.mv_stock_fina_indicator` / `features.mv_stock_industry_monthly_snapshot` çš„åŸºç¡€ä¸Šï¼Œæ–°å¢ä¸¤å¼ â€œè´¢æŠ¥åŸºç¡€è¡¨â€çš„ PIT åŒ– MVï¼Œç»“æ„ä¸ `stock_fina_indicator.py` å¯¹é½ï¼š

| é˜¶æ®µ | ä»»åŠ¡ | äº§å‡º | è¯´æ˜ |
|------|------|------|------|
| D0 | æ˜ç¡® MV PIT å¥‘çº¦å­—æ®µ | æ–‡æ¡£/å¡ç‰‡çº¦æŸ | ç»Ÿä¸€è¦æ±‚è¾“å‡ºåŒ…å« `query_start_date/query_end_date/report_period/ann_date` |
| D1 | æ–°å¢ `features.mv_stock_income_quarterly` | MV é…æ–¹ + å¯ init/refresh | æ¥æºï¼š`rawdata.fina_income`ï¼ˆåˆ©æ¶¦è¡¨ï¼‰ |
| D2 | æ–°å¢ `features.mv_stock_balance_quarterly` | MV é…æ–¹ + å¯ init/refresh | æ¥æºï¼š`rawdata.fina_balancesheet`ï¼ˆèµ„äº§è´Ÿå€ºè¡¨ï¼‰ |
| D3 | è¡¥é½æ ¡éªŒä¸å¯¹æ¯”è„šæœ¬ | scripts/éªŒè¯æŠ¥å‘Š | å¯¹é½æ ¡éªŒè§ D-1/D-2/D-3 |

> è¯´æ˜ï¼šincome/balance ä¸¤å¼  MV å…ˆâ€œä½è€¦åˆè½åœ°â€ï¼ˆä»¥ `SELECT *` + PIT çª—å£ä¸ºä¸»ï¼‰ï¼Œåç»­å†åŸºäºç”„åˆ«æµç¨‹æ”¶æ•›å­—æ®µå£å¾„å¹¶è¡¥å¡ç‰‡ã€‚

#### 6.2.2 æ›´ä¸¥æ ¼éªŒæ”¶ï¼ˆD-1 / D-2 / D-3ï¼‰

ä¸ºç¡®ä¿â€œMV PIT åŒ–æ›¿ä»£â€è¾¾åˆ°ç”Ÿäº§å¯ç”¨æ ‡å‡†ï¼ŒM6 çš„éªŒæ”¶ä»â€œèƒ½è·‘â€å‡çº§ä¸ºä»¥ä¸‹ä¸‰é“é—¨æ§›ï¼š

- **D-1ï¼šPIT çª—å£æ­£ç¡®æ€§ + æ•°æ®å¥‘çº¦**
  - æ¯å¼  MV å¿…é¡»åŒ…å«å¹¶æ»¡è¶³ï¼š
    - `query_start_date = ann_date`
    - `query_end_date >= query_start_date`
    - `report_period = end_date`ï¼ˆè´¢æŠ¥ç±»ï¼‰
  - åŒä¸€ `ts_code` ä¸‹ PIT çª—å£ä¸å…è®¸â€œæœªæ¥ä¿¡æ¯æ³„æ¼â€ï¼š`query_end_date` å¿…é¡»ç”±ä¸‹ä¸€æ¡å…¬å‘Šæ—¥æ¨å¯¼ï¼ˆæˆ–å°é¡¶åˆ°è¿œæœŸæ—¥æœŸï¼‰ã€‚
  - è¾“å‡ºå¿…é¡»å¯ä½œä¸ºä¸‹æ¸¸ join keyï¼ˆè‡³å°‘åŒ…å« `ts_code` + PIT çª—å£å­—æ®µï¼‰ï¼Œå¹¶é€šè¿‡å”¯ä¸€æ€§/ç©ºå€¼ç‡/çª—å£ä¸€è‡´æ€§æ ¡éªŒã€‚

- **D-2ï¼šä¸æ—¢æœ‰ PIT äº§å‡ºå¯¹æ¯”ï¼ˆå¯é‡åŒ–ï¼‰**
  - å¯¹ `income/balance`ï¼šæŠ½æ ·å¯¹æ¯” `pgs_factors.pit_income_quarterly` / `pgs_factors.pit_balance_quarterly` åœ¨æœ€è¿‘ N å¹´çš„æ•°æ®è¦†ç›–ä¸å…³é”®å­—æ®µä¸€è‡´æ€§ã€‚
  - å¯¹ `industry/fina_indicator`ï¼šæŠ½æ ·å¯¹æ¯”ç°æœ‰ä¸‹æ¸¸æ¶ˆè´¹æŸ¥è¯¢çš„ç»“æœï¼ˆè¡Œæ•°ã€åˆ†å¸ƒã€å…³é”®å­—æ®µï¼‰ï¼Œæ˜ç¡®å¯æ¥å—å·®å¼‚é˜ˆå€¼å¹¶å›ºåŒ–æˆè„šæœ¬ã€‚

- **D-3ï¼šå¯è¿ç»´æ€§ä¸å¹‚ç­‰æ€§**
  - `scripts/features_init.py` èƒ½åˆå§‹åŒ–å¹¶åˆ·æ–°ç›¸å…³ MVï¼›è¿ç»­æ‰§è¡Œ 2 æ¬¡æ— å‰¯ä½œç”¨ã€‚
  - åˆ·æ–°ç­–ç•¥ã€ç´¢å¼•ä¸å¹¶å‘åˆ·æ–°èƒ½åŠ›ï¼ˆå¦‚å¯ç”¨ concurrentï¼‰å…·å¤‡æ˜ç¡®å‰ç½®æ¡ä»¶ä¸å¤±è´¥å›æ»šç­–ç•¥ã€‚
  - è¾“å‡ºåŒ…å«åŸºç¡€è¡€ç¼˜å­—æ®µï¼ˆå¦‚ `_source_table/_processed_at/_data_version`ï¼‰ï¼Œä¾¿äºè¿½è¸ªä¸å®¡è®¡ã€‚

---

## 7. é£é™©ä¸ç¼“è§£

### 7.1 é£é™©æ¸…å•

| é£é™© | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|----------|
| è¿ç§»è¿‡ç¨‹ä¸­å¼•å…¥ bug | ç‰©åŒ–è§†å›¾åˆ·æ–°å¤±è´¥ | è¿ç§»åå¯¹æ¯”åŸæœ‰äº§å‡º |
| Barra è„šæœ¬è§£è€¦ä¸å®Œæ•´ | ç”Ÿäº§ Barra å› å­ä¸­æ–­ | åˆ†é˜¶æ®µéªŒè¯ï¼Œä¿ç•™å›æ»šèƒ½åŠ› |
| CLI ç§»é™¤åæ“ä½œä¸ä¾¿ | æ—¥å¸¸è¿ç»´éœ€å†™è„šæœ¬ | æä¾›æœ€å°åŒ–çš„ Python è„šæœ¬å…¥å£ |
| ç‰¹å¾ç”„åˆ«é—æ¼ | é‡è¦ç‰¹å¾æœªå…¥åº“ | ä¿æŒç”„åˆ«æ¸…å•å¯æ‰©å±• |

### 7.2 éªŒæ”¶æŒ‡æ ‡

| ç±»åˆ« | éªŒæ”¶æŒ‡æ ‡ | é€šè¿‡æ ‡å‡† |
|------|----------|----------|
| **åŠŸèƒ½éªŒæ”¶** | è‡³å°‘ 1 ä¸ª features MV å¯åˆ›å»ºã€åˆ·æ–°ã€æ ¡éªŒã€è¢«ä¸‹æ¸¸è¯»å– | è„šæœ¬è¿è¡Œæ— æŠ¥é”™ï¼Œæ•°æ®ä¸€è‡´ |
| **ä¾èµ–éªŒæ”¶** | å…¨é¡¹ç›®æ— æ—§ processors import | PowerShell `Select-String -Path alphahome/**,scripts/**,tests/** -Pattern "processors." -SimpleMatch` è¿”å›ç©ºï¼ˆæˆ– `rg "processors\."` è¿”å›ç©ºï¼‰ |
| **å¯è¿ç»´æ€§** | åˆå§‹åŒ–/åˆ·æ–°/æ ¡éªŒå‡æœ‰è„šæœ¬å…¥å£ä¸”å¯é‡å¤æ‰§è¡Œ | è¿ç»­è¿è¡Œ 2 æ¬¡æ— å‰¯ä½œç”¨ |
| **ç”„åˆ«å®Œæ•´æ€§** | é¦–æ‰¹ç‰¹å¾å…¨éƒ¨æœ‰å…¥åº“å¡ç‰‡ | `alphahome/features/cards/*.yaml` ä¸æ¸…å•ä¸€ä¸€å¯¹åº” |
| **å›å½’æµ‹è¯•** | Barra å› å­è®¡ç®—ç»“æœä¸è¿ç§»å‰ä¸€è‡´ | å› å­å€¼å·®å¼‚ < 1e-6 |

### 7.3 å›æ»šç­–ç•¥

| é˜¶æ®µ | å›æ»šè§¦å‘æ¡ä»¶ | å›æ»šæ­¥éª¤ |
|------|--------------|----------|
| Aï¼ˆfeatures éª¨æ¶ï¼‰ | ç›®å½•ç»“æ„æˆ–æ¥å£è®¾è®¡ä¸¥é‡ç¼ºé™· | åˆ é™¤ `alphahome/features/`ï¼Œé‡æ–°è®¾è®¡ |
| Bï¼ˆç‰©åŒ–è§†å›¾è¿ç§»ï¼‰ | MV åˆ·æ–°é€»è¾‘è¿ç§»åé¢‘ç¹å¤±è´¥ | å›é€€åˆ°è¿ç§»å‰å®ç°ï¼ˆæ¢å¤ `processors/materialized_views/` çš„ä½¿ç”¨è·¯å¾„ï¼‰ï¼Œä¿ç•™ features ä½†ä¸å¯ç”¨ |
| Cï¼ˆBarra è§£è€¦ï¼‰ | Barra å› å­è®¡ç®—å¼‚å¸¸ | scripts æ¢å¤æ—§ import è·¯å¾„ |
| Dï¼ˆCLI ä¸‹çº¿ï¼‰ | è¿ç»´ç—›ç‚¹è¶…å‡ºé¢„æœŸ | æ¢å¤ `cli/commands/mv.py`ï¼ˆä» Git å†å²æ¢å¤ï¼‰ |
| Eï¼ˆprocessors åˆ é™¤ï¼‰ | å‘ç°é—æ¼ä¾èµ– | ä» Git å†å²æ¢å¤æ•´ä¸ªç›®å½• |

**å›æ»šåŸåˆ™**ï¼š
- æ¯é˜¶æ®µå®Œæˆå **Git æ‰“ tag**ï¼ˆå¦‚ `features-mig-A-done`ï¼‰ï¼Œä¾¿äºå®šç‚¹æ¢å¤ã€‚
- æ•°æ®åº“å±‚é¢ï¼šç‰©åŒ–è§†å›¾åˆ é™¤å‰å…ˆ `DROP ... IF EXISTS`ï¼Œæ–°æ—§è§†å›¾å¯å…±å­˜è¿‡æ¸¡ã€‚

---

## 8. é‡Œç¨‹ç¢‘

| é‡Œç¨‹ç¢‘ | åŒ…å«é˜¶æ®µ | é¢„æœŸäº§å‡º | çŠ¶æ€ |
|--------|----------|----------|------|
| M1: features éª¨æ¶ | A1 | `alphahome/features/` å¯ import | âœ… å·²å®Œæˆ |
| M2: ç‰©åŒ–è§†å›¾è¿ç§»å®Œæˆ | A2-A6 | features/storage å¯ç‹¬ç«‹è¿è¡Œ | âœ… å·²å®Œæˆ |
| M3: Barra è§£è€¦å®Œæˆ | B1-B5 | scripts/tests æ—  processors.tasks.barra ä¾èµ– | âœ… å·²å®Œæˆ |
| M4: CLI ä¸‹çº¿ | C1-C4 | æ—  CLI å…¥å£ï¼Œcli/ æœ€å°åŒ– | âœ… å·²å®Œæˆ |
| M5: processors åˆ é™¤ | D1-D4 | ç›®å½•å·²åˆ é™¤ | âœ… å·²å®Œæˆ |
| M6: PIT æ›¿ä»£å®Œæˆï¼ˆMV PIT åŒ–ï¼‰ | D0-D3 | income/balance/industry/fina_indicator ç­‰å¯ PIT æ¶ˆè´¹çš„ MV è¾¾åˆ° D-1/D-2/D-3 éªŒæ”¶ | âœ… å·²å®Œæˆ |
| M7: é¦–æ‰¹ç‰¹å¾å…¥åº“ | åŸºäºç”„åˆ«æ¸…å• | valuation/breadth/margin/volatility/limit ç­‰ MV å¯ç”¨ | ğŸ”„ è¿›è¡Œä¸­ |

---

## 9. é™„å½•

### 9.1 ç›¸å…³æ–‡æ¡£

- [ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ](system_overview.md)
- [ä»»åŠ¡ç³»ç»Ÿè®¾è®¡](task_system.md)
- [PIT å¢é‡æ›´æ–°æŒ‡å—](../pit_incremental_update_guide.md)

### 9.2 å¾…å†³äº‹é¡¹

| äº‹é¡¹ | é€‰é¡¹ | å½“å‰å€¾å‘ |
|------|------|----------|
| ç‰©åŒ–è§†å›¾ schema å‘½å | `materialized_views` vs `features` | æ¸è¿›è¿ç§»åˆ° `features` |
| operations æ˜¯å¦ä¿ç•™ | è¿åˆ° common vs åºŸå¼ƒ | åºŸå¼ƒï¼ˆå¤–éƒ¨æ— å¼•ç”¨ï¼‰ |
| research/pit_data è¿ç§»åæ˜¯å¦ä¿ç•™ | ä¿ç•™å…¥å£ vs åˆ é™¤ | å¾…è®¨è®º |

---

## 10. å˜æ›´è®°å½•

| æ—¥æœŸ | ç‰ˆæœ¬ | å˜æ›´å†…å®¹ |
|------|------|----------|
| 2026-01-27 | v0.1 | åˆç¨¿ï¼ŒåŸºäºè®¨è®ºæ•´ç† |
| 2026-01-27 | v0.2 | è¡¥å¼ºå…³é”®ç‚¹ï¼š1) Section 1.4 CLI è¾¹ç•Œæ¾„æ¸…ï¼›2) Section 3.3 features æ ¸å¿ƒæ¥å£å¥‘çº¦ï¼›3) Section 4.0 æ‰§è¡Œé¡ºåºæµç¨‹å›¾ï¼›4) Section 5 å…«æ­¥ç”„åˆ«æµç¨‹ + å…¥åº“å¡ç‰‡æ¨¡æ¿ï¼›5) Section 7.2/7.3 éªŒæ”¶æŒ‡æ ‡ + å›æ»šç­–ç•¥ |
| 2026-01-27 | v0.3 | å¯è¡Œæ€§å®¡æŸ¥ä¿®æ­£ï¼š1) Section 2.3 è¡¥å…… 4 ä¸ª MV å®šä¹‰æ–‡ä»¶è¿ç§»æ¸…å•ï¼›2) Section 3.2 è¡¥å…… cards/ ç›®å½•ï¼›3) Section 4.1 A6 å¼•ç”¨ MV æ¸…å•ï¼›4) Section 4.2 B5 æµ‹è¯•è·¯å¾„ä¿®æ­£ |
| 2026-01-29 | v0.4 | è¡¥å…… features å‘½åä¸ç›®å½•è§„èŒƒï¼ˆå¯¹é½ fetchers çš„å¯è¯»æ€§åŸåˆ™ï¼‰ï¼›æ˜ç¡® recipes åˆ†åŸŸç›®å½•ä¸è¾“å‡ºå¯¹è±¡å‘½åï¼›ç»†åŒ– A6 çš„è½åœ°çº¦æŸä¸å…¼å®¹ç­–ç•¥ |
| 2026-01-29 | v0.5 | **ä»£ç è½åœ°**ï¼š1) å®ç° @feature_register è£…é¥°å™¨ + FeatureRegistry.discover() åŠ¨æ€æ‰«æï¼›2) é‡ç»„ recipes/mv/ ä¸º {domain}/ åˆ†ç»„ç»“æ„ï¼›3) è¿ç§» 4 ä¸ª MV åˆ°åˆ†åŸŸç›®å½•å¹¶æ·»åŠ è£…é¥°å™¨ï¼›4) ä¿ç•™å…¼å®¹å¯¼å‡ºï¼›5) éªŒè¯é€šè¿‡ |
| 2026-01-29 | v0.6 | æ–‡æ¡£å…¨é¢å¯¹é½ç°çŠ¶ï¼šæ›´æ–° MV æ¸…å•ä¸ç›®å½•è§„èŒƒï¼ˆç§»é™¤ mv/pit wrapper æè¿°ï¼‰ã€ä¿®æ­£æ•°æ®æµå‘ï¼ˆåŒºåˆ† research/pit_data ç°çŠ¶ä¸ features/pit è§„åˆ’ï¼‰ã€åŒæ­¥ BaseFeatureView/FeatureRegistry çš„å·²è½åœ°å¥‘çº¦ä¸é‡Œç¨‹ç¢‘çŠ¶æ€ |
| 2026-01-29 | v0.7 | **Barra è§£è€¦å®Œæˆ**ï¼šæ–°å¢ `alphahome/barra/tasks/`ï¼ˆ3 ä¸ªä»»åŠ¡ + ç‹¬ç«‹åºåˆ—åŒ–ï¼‰ï¼Œæ›´æ–° scripts/tests import è·¯å¾„ï¼Œ`tests/unit/test_barra` å…¨é‡é€šè¿‡ |
| 2026-01-29 | v0.8 | **Phase 3 è¿›å±•**ï¼šå®Œæˆ C1-C4 CLI å…¥å£ä¸‹çº¿ï¼ˆpyproject.toml ç§»é™¤ 4 ä¸ªå…¥å£ç‚¹ï¼Œcli/ ç›®å½•æœ€å°åŒ–ï¼‰ï¼›å®Œæˆ D1 éªŒæ”¶ï¼ˆscripts/tests æ—  processors å¼•ç”¨ï¼‰ï¼Œå¾…æ‰§è¡Œ D2-D4 åˆ é™¤ processors |
| 2026-01-29 | v0.9 | **Phase 3 å®Œæˆ**ï¼šæ‰§è¡Œ D2-D4ï¼Œåˆ é™¤ `alphahome/processors/` ç›®å½•ã€ç§»é™¤é¡¶å±‚å¯¼å‡ºã€åŒæ­¥ README/docs/repowiki å»é™¤ processors/CLI å¼•ç”¨ï¼›å…¨ä»“ grep æ¸…é›¶éªŒæ”¶ã€pytest 104 passed |
| 2026-01-29 | v0.10 | **M6 ç­–ç•¥è°ƒæ•´**ï¼š6.2 æ”¹ä¸º"MV PIT åŒ–æ›¿ä»£ï¼ˆæ–¹æ¡ˆ Dï¼‰"ï¼Œæ–°å¢ income/balance ä¸¤å¼ æ´¾ç”Ÿ MV çš„ä¸‹ä¸€æ­¥è®¡åˆ’ï¼Œå¹¶å¼•å…¥æ›´ä¸¥æ ¼éªŒæ”¶ D-1/D-2/D-3 |
| 2026-01-29 | v0.11 | **M6 D1/D2 å®Œæˆ**ï¼šè½åœ° `stock_income_quarterly.py`ã€`stock_balance_quarterly.py`ï¼›FeatureRegistry å¯å‘ç° 6 ä¸ªé…æ–¹ï¼›pytest 104 passed |
| 2026-01-29 | v0.12 | **M6 D3 éªŒæ”¶é€šè¿‡**ï¼šä¿®å¤è´¢æŠ¥ç±» MV çš„ PIT çª—å£é€»è¾‘ï¼ˆåŒä¸€å…¬å‘Šæ—¥å¤šæ¡è®°å½•é—®é¢˜ï¼šæ”¹ç”¨ DISTINCT + LEAD ä¸‰æ®µ CTEï¼‰ï¼›åˆ›å»º `scripts/features_validate_pit.py` éªŒæ”¶è„šæœ¬ï¼›D-1/D-2/D-3 å…¨éƒ¨é€šè¿‡ |
| 2026-01-30 | v0.13 | **å®Œå…¨å¯¹æ ‡ PIT è¡¨**ï¼šincome MV æ•´åˆ report+express+forecast ä¸‰æ•°æ®æºï¼ˆè¦†ç›–ç‡ 108%ï¼‰ï¼›balance MV æ•´åˆ report+expressï¼ˆè¦†ç›–ç‡ 103%ï¼‰ï¼›MV å®Œå…¨è¦†ç›– PIT è¡¨ï¼ˆPIT ç‹¬æœ‰è®°å½•ä¸º 0ï¼‰ï¼›éªŒæ”¶å…¨éƒ¨é€šè¿‡ |
| 2026-01-30 | v0.14 | **è¡Œä¸šåˆ†ç±»å¯¹æ ‡å®Œæˆ**ï¼š`stock_industry_monthly_snapshot.py`ï¼ˆæœˆåº¦å¿«ç…§ï¼‰æ•´åˆ sw+ci åŒæ•°æ®æºï¼ˆ1.68M è¡Œï¼‰ï¼Œå®Œå…¨è¦†ç›– pit_industry_classificationï¼ˆL1/L2 åŒ¹é…ç‡ 100%ï¼Œè¦†ç›–ç‡ 120%ï¼‰ï¼›å•å…ƒæµ‹è¯• 7 passed |
| 2026-01-30 | v0.15 | **å‘½åæ”¶æ•›å®Œæˆ**ï¼šè¡Œä¸š MV æœ€ç»ˆå‘½åä¸º `stock_industry_monthly_snapshot`ï¼ˆç±»å `StockIndustryMonthlySnapshotMV`ã€MV å `mv_stock_industry_monthly_snapshot`ï¼‰ï¼›å…¨ä»“å¼•ç”¨ç»Ÿä¸€æ›´æ–°ï¼›å…¼å®¹åˆ«å `StockSwIndustryMV` ä¿ç•™ï¼›å•å…ƒæµ‹è¯• 7 passed |
| 2026-01-30 | v0.16 | **M7 ç”„åˆ«æ¸…å•å®Œæˆ**ï¼šå…¨é¢åˆ†æ data_infra 34 ä¸ª Fetcherï¼Œå®Œæˆ Section 5.4 ç”„åˆ«çŠ¶æ€è¡¨ï¼ˆæ¨èå…¥åº“ 20 é¡¹ã€éœ€è¯„å®¡ 19 é¡¹ã€ä¸å…¥åº“ 8 é¡¹ï¼‰ï¼›æ˜ç¡®ä¾èµ–è¡¨ã€æ—¶é—´è¯­ä¹‰ã€PIT å®‰å…¨æ€§ |
| 2026-01-30 | v0.17 | **M7 é¦–æ‰¹ MV è½åœ°**ï¼šæ–°å¢ 5 ä¸ª market åŸŸ MVï¼ˆ`index_valuation_daily`ã€`market_breadth_daily`ã€`margin_ratio_monthly`ã€`index_volatility_daily`ã€`limit_updown_daily`ï¼‰ï¼›åˆ›å»º 2 å¼ å…¥åº“å¡ç‰‡ï¼ˆ`index_valuation_daily.yaml`ã€`market_breadth_daily.yaml`ï¼‰ï¼›FeatureRegistry.discover() = 11 ä¸ª recipeï¼›å•å…ƒæµ‹è¯• 7 passed |
| 2026-01-30 | v0.18 | **M7 å®Œç»“**ï¼šæ–°å¢ 6 ä¸ª market åŸŸ MVï¼ˆ`market_technical_daily`ã€`index_technical_daily`ã€`style_features_daily`ã€`margin_turnover_daily`ã€`etf_flow_daily`ã€`index_fundamental_daily`ï¼‰ï¼›åˆå¹¶ 8 ä¸ª Fetcherï¼ˆmargin_turnover_ratioã€index_fundamentalã€market_technicalã€market_return_distributionã€index_boll_signalsã€index_ma120_distanceã€etf_flowã€style_index_return/style_momentumï¼‰ï¼›ç”„åˆ«çŠ¶æ€è¡¨å…¨éƒ¨æ›´æ–°ä¸º âœ…ï¼›å•å…ƒæµ‹è¯• 18 passed |
