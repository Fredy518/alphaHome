# Fetchers æ™ºèƒ½å¢é‡æ›´æ–°ç­–ç•¥æ”¹é€ å»ºè®®æ¸…å•

## æ€»ä½“åˆ†æ

å½“å‰ `alphahome/fetchers/tasks` ä¸­ï¼Œæœ‰éƒ¨åˆ†ä»»åŠ¡æ˜¯**å…¨é‡æ›´æ–°åªä»»åŠ¡**ï¼ˆ`date_column = None`ï¼‰æˆ–**API ä¸æ”¯æŒå¢é‡æŸ¥è¯¢çš„ä»»åŠ¡**ï¼Œæ•°æ®é‡è¾ƒå¤§ã€‚è¿™äº›ä»»åŠ¡ç›®å‰ç¼ºä¹æ™ºèƒ½è°ƒåº¦æœºåˆ¶ï¼Œæ¯æ¬¡æ‰§è¡Œéƒ½ä¼šè¿›è¡Œå…¨é‡è·å–å’Œæ›´æ–°ï¼Œæµªè´¹èµ„æºã€‚

æœ¬æ–‡æ¡£æ¨èé‡‡ç”¨**"æ™ºèƒ½å¢é‡"ç­–ç•¥**ï¼Œåœ¨ç”Ÿäº§ç¯ä¿ä¸‹é€šè¿‡æ£€æŸ¥ `max(update_time)` å’Œäº¤æ˜“æ—¥å†æ¥è‡ªåŠ¨åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰§è¡Œå…¨é‡æ›´æ–°ï¼š
- **æ¡ä»¶ 1**ï¼šè·ç¦»ä¸Šæ¬¡æ›´æ–°è¶…è¿‡ **1 ä¸ªæœˆ**ï¼ˆ30å¤©ï¼‰
- **æ¡ä»¶ 2**ï¼šå½“å¤©ä¸º**éäº¤æ˜“æ—¥**ï¼ˆéå·¥ä½œæ—¥æˆ–èŠ‚å‡æ—¥ï¼‰

åªæœ‰**åŒæ—¶æ»¡è¶³**è¿™ä¸¤ä¸ªæ¡ä»¶ï¼Œæ‰ä¼šæ‰§è¡Œå…¨é‡æ›´æ–°ï¼Œå¦åˆ™è·³è¿‡ã€‚

---

## å·²å®ç°æ™ºèƒ½å¢é‡ç­–ç•¥çš„ä»»åŠ¡

è¿™äº›ä»»åŠ¡å·²ç»å®Œæˆæ”¹é€ ï¼Œå¯ä½œä¸ºå‚è€ƒï¼š

| ä»»åŠ¡å | è¡¨å | æ–‡ä»¶ | è¯´æ˜ |
|------|------|------|------|
| `tushare_stock_thsindex` | `stock_thsindex` | `stock/tushare_stock_thsindex.py` | åŒèŠ±é¡ºæ¦‚å¿µå’Œè¡Œä¸šæŒ‡æ•°ï¼ˆâœ… åˆšå®Œæˆï¼‰ |
| `tushare_stock_thsmember` | `stock_thsmember` | `stock/tushare_stock_thsmember.py` | åŒèŠ±é¡ºæ¦‚å¿µæ¿å—æˆåˆ† |
| `tushare_stock_pledgestat` | `stock_pledgestat` | `stock/tushare_stock_pledgestat.py` | è‚¡æƒè´¨æŠ¼ç»Ÿè®¡æ•°æ® |

**å…±åŒç‰¹ç‚¹**ï¼š
- éƒ½æ˜¯å…¨é‡æ›´æ–°ä»»åŠ¡æˆ– API ä¸æ”¯æŒçœŸæ­£çš„å¢é‡æŸ¥è¯¢
- éƒ½å®ç°äº† `async def _should_perform_full_update(self) -> bool` æ–¹æ³•
- éƒ½åœ¨ `get_batch_list` ä¸­æ£€æŸ¥ `UpdateTypes.SMART` å¹¶åšå‡ºåˆ¤æ–­

---

## æ¨èæ”¹é€ çš„ä»»åŠ¡æ¸…å•

### ğŸ”´ P1 ä¼˜å…ˆçº§ï¼ˆå¼ºçƒˆæ¨èï¼‰

è¿™äº›ä»»åŠ¡**æ•°æ®é‡å¤§**ã€**æ›´æ–°é¢‘ç‡ä½**ã€**æ— å¢é‡æŸ¥è¯¢èƒ½åŠ›**ï¼Œæœ€é€‚åˆé‡‡ç”¨æ™ºèƒ½å¢é‡ç­–ç•¥ã€‚

#### 1. `tushare_fund_basic` - åŸºé‡‘åŸºç¡€ä¿¡æ¯
- **è¡¨å**ï¼š`fund_basic`
- **æ•°æ®é‡**ï¼šä¸­ç­‰ï¼ˆ~10,000æ¡åŸºé‡‘ï¼‰
- **æ›´æ–°é¢‘ç‡**ï¼šä½ï¼ˆæ–°åŸºé‡‘å‘è¡Œã€é€€å¸‚é¢‘ç‡ä½ï¼‰
- **ç‰¹ç‚¹**ï¼šå…¨é‡ä»»åŠ¡ï¼ˆ`date_column = None`ï¼‰ï¼Œä¸»é”®æ˜¯ `ts_code`
- **API ç‰¹æ€§**ï¼šä¸æ”¯æŒæŒ‰æ—¥æœŸæŸ¥è¯¢ï¼Œåªèƒ½å…¨é‡è·å–
- **æ”¹é€ éš¾åº¦**ï¼šâ­â­â­ ç®€å•
- **é¢„æœŸæ”¶ç›Š**ï¼šé«˜ï¼Œé¿å…é¢‘ç¹æ— æ„ä¹‰çš„å…¨é‡åˆ·æ–°

#### 2. `tushare_fund_etf_basic` - ETF åŸºç¡€ä¿¡æ¯
- **è¡¨å**ï¼š`fund_etf_basic`
- **æ•°æ®é‡**ï¼šä¸­ç­‰ï¼ˆ~3,000+ETFï¼‰
- **æ›´æ–°é¢‘ç‡**ï¼šä½ï¼ˆETF å‘è¡Œ/é€€å¸‚é¢‘ç‡ä½ï¼‰
- **ç‰¹ç‚¹**ï¼šå…¨é‡ä»»åŠ¡ï¼ˆ`date_column = None`ï¼‰ï¼Œä¸»é”®æ˜¯ `ts_code`
- **API ç‰¹æ€§**ï¼šä¸æ”¯æŒæŒ‰æ—¥æœŸæŸ¥è¯¢ï¼Œåªèƒ½å…¨é‡è·å–
- **æ”¹é€ éš¾åº¦**ï¼šâ­â­â­ ç®€å•
- **é¢„æœŸæ”¶ç›Š**ï¼šé«˜

#### 3. `tushare_fund_etf_index` - ETF æˆåˆ†æƒé‡
- **è¡¨å**ï¼š`fund_etf_index`
- **æ•°æ®é‡**ï¼šä¸­ç­‰ï¼ˆETF æ•° Ã— æ¯ä¸ª ETF çš„æˆåˆ†æ•°ï¼‰
- **æ›´æ–°é¢‘ç‡**ï¼šä½ï¼ˆæƒé‡è°ƒæ•´ä¸é¢‘ç¹ï¼‰
- **ç‰¹ç‚¹**ï¼šå…¨é‡ä»»åŠ¡ï¼ˆ`date_column = None`ï¼‰ï¼Œä¸»é”®æ˜¯ `ts_code, etf_code`
- **API ç‰¹æ€§**ï¼šä¸æ”¯æŒæŒ‰æ—¥æœŸæŸ¥è¯¢ï¼Œåªèƒ½å…¨é‡è·å–
- **æ”¹é€ éš¾åº¦**ï¼šâ­â­â­ ç®€å•
- **é¢„æœŸæ”¶ç›Š**ï¼šé«˜

#### 4. `tushare_index_basic` - æŒ‡æ•°åŸºç¡€ä¿¡æ¯
- **è¡¨å**ï¼š`index_basic`
- **æ•°æ®é‡**ï¼šä¸­ç­‰ï¼ˆ~1000+æŒ‡æ•°ï¼‰
- **æ›´æ–°é¢‘ç‡**ï¼šä½ï¼ˆæ–°æŒ‡æ•°å‘è¡Œé¢‘ç‡ä½ï¼‰
- **ç‰¹ç‚¹**ï¼šå…¨é‡ä»»åŠ¡ï¼ˆ`date_column = None`ï¼‰ï¼Œä¸»é”®æ˜¯ `ts_code`
- **API ç‰¹æ€§**ï¼šä¸æ”¯æŒæŒ‰æ—¥æœŸæŸ¥è¯¢ï¼Œåªèƒ½å…¨é‡è·å–
- **æ”¹é€ éš¾åº¦**ï¼šâ­â­â­ ç®€å•
- **é¢„æœŸæ”¶ç›Š**ï¼šä¸­

#### 5. `tushare_stock_basic` - è‚¡ç¥¨åŸºç¡€ä¿¡æ¯
- **è¡¨å**ï¼š`stock_basic`
- **æ•°æ®é‡**ï¼šä¸­ç­‰ï¼ˆ~5,000-6,000 è‚¡ç¥¨ï¼‰
- **æ›´æ–°é¢‘ç‡**ï¼šä½ï¼ˆæ–°è‚¡å‘è¡Œé¢‘ç‡ç›¸å¯¹ä½ï¼Œé€€å¸‚ä¹Ÿä¸é¢‘ç¹ï¼‰
- **ç‰¹ç‚¹**ï¼šå…¨é‡ä»»åŠ¡ï¼ˆ`date_column = None`ï¼‰ï¼Œä½†éœ€æŒ‰ `list_status` åˆ†æ‰¹
- **API ç‰¹æ€§**ï¼šä¸æ”¯æŒæŒ‰æ—¥æœŸæŸ¥è¯¢ï¼Œæ”¯æŒæŒ‰ `list_status` è¿‡æ»¤
- **æ”¹é€ éš¾åº¦**ï¼šâ­â­â­â­ ä¸­ç­‰ï¼ˆéœ€ä¿æŒ BatchPlanner åˆ†æ‰¹é€»è¾‘ï¼‰
- **é¢„æœŸæ”¶ç›Š**ï¼šä¸­

#### 6. `tushare_index_swmember` - ç”³ä¸‡è¡Œä¸šæˆåˆ†
- **è¡¨å**ï¼š`index_swmember`
- **æ•°æ®é‡**ï¼šä¸­ç­‰ï¼ˆç”³ä¸‡è¡Œä¸šæ•° Ã— æ¯ä¸ªè¡Œä¸šçš„æˆåˆ†æ•°ï¼‰
- **æ›´æ–°é¢‘ç‡**ï¼šä½ï¼ˆæˆåˆ†è°ƒæ•´ä¸é¢‘ç¹ï¼‰
- **ç‰¹ç‚¹**ï¼šå…¨é‡ä»»åŠ¡ï¼ˆ`date_column = None`ï¼‰ï¼Œä¸»é”®æ˜¯ `ts_code, con_code`
- **API ç‰¹æ€§**ï¼šä¸æ”¯æŒæŒ‰æ—¥æœŸæŸ¥è¯¢ï¼Œåªèƒ½å…¨é‡è·å–
- **æ”¹é€ éš¾åº¦**ï¼šâ­â­â­ ç®€å•
- **é¢„æœŸæ”¶ç›Š**ï¼šä¸­

#### 7. `tushare_index_cimember` - ä¸­ä¿¡è¡Œä¸šæˆåˆ†
- **è¡¨å**ï¼š`index_cimember`
- **æ•°æ®é‡**ï¼šä¸­ç­‰ï¼ˆä¸­ä¿¡è¡Œä¸šæ•° Ã— æ¯ä¸ªè¡Œä¸šçš„æˆåˆ†æ•°ï¼‰
- **æ›´æ–°é¢‘ç‡**ï¼šä½ï¼ˆæˆåˆ†è°ƒæ•´ä¸é¢‘ç¹ï¼‰
- **ç‰¹ç‚¹**ï¼šå…¨é‡ä»»åŠ¡ï¼ˆ`date_column = None`ï¼‰ï¼Œä¸»é”®æ˜¯ `ts_code, con_code`
- **API ç‰¹æ€§**ï¼šä¸æ”¯æŒæŒ‰æ—¥æœŸæŸ¥è¯¢ï¼Œåªèƒ½å…¨é‡è·å–
- **æ”¹é€ éš¾åº¦**ï¼šâ­â­â­ ç®€å•
- **é¢„æœŸæ”¶ç›Š**ï¼šä¸­

#### 8. `tushare_stock_dcmember` - ä¸œè´¢æ¦‚å¿µæ¿å—æˆåˆ†
- **è¡¨å**ï¼š`stock_dcmember`
- **æ•°æ®é‡**ï¼šä¸­ç­‰ï¼ˆæ¿å—æ•° Ã— æ¯ä¸ªæ¿å—çš„æˆåˆ†æ•°ï¼‰
- **æ›´æ–°é¢‘ç‡**ï¼šä½ï¼ˆæˆåˆ†è°ƒæ•´ä¸é¢‘ç¹ï¼‰
- **ç‰¹ç‚¹**ï¼šåˆ†æœˆæœ«ä»»åŠ¡ï¼ˆ`date_column = "trade_date"`ï¼‰ï¼Œä½†å®é™…ä¸Šæ˜¯æŒ‰æœˆä»½çš„å…¨é‡æ•°æ®
- **API ç‰¹æ€§**ï¼šåªæ”¯æŒæŒ‰ `trade_date` æŸ¥è¯¢ç‰¹å®šæ—¥æœŸçš„æˆåˆ†ï¼Œä¸æ”¯æŒçœŸæ­£çš„å¢é‡
- **æ”¹é€ éš¾åº¦**ï¼šâ­â­â­â­ ä¸­ç­‰ï¼ˆéœ€ä¿æŒç°æœ‰çš„æœˆæœ«åˆ†æ‰¹é€»è¾‘ï¼‰
- **é¢„æœŸæ”¶ç›Š**ï¼šä¸­

---

### ğŸŸ  P2 ä¼˜å…ˆçº§ï¼ˆé€‚åº¦æ¨èï¼‰

è¿™äº›ä»»åŠ¡ç‰¹ç‚¹**ç›¸å¯¹ç‰¹æ®Š**ï¼Œæ”¹é€ **éœ€è¦é¢å¤–è€ƒé‡**ï¼Œä½†ä»æœ‰æ”¹é€ ä»·å€¼ã€‚

#### 9. `tushare_stock_codemapping` - è‚¡ç¥¨ä»£ç æ˜ å°„
- **è¡¨å**ï¼š`stock_codemapping`
- **æ•°æ®é‡**ï¼šè¾ƒå°ï¼ˆ~5,000 æ¡ï¼Œæ¯ä¸ªè‚¡ç¥¨ä¸€æ¡æ˜ å°„è®°å½•ï¼‰
- **æ›´æ–°é¢‘ç‡**ï¼šå¾ˆä½ï¼ˆåŸºæœ¬ä¸å˜ï¼‰
- **ç‰¹ç‚¹**ï¼šå‚è€ƒæ•°æ®ï¼Œå‡ ä¹ä¸å˜
- **API ç‰¹æ€§**ï¼šå…¨é‡è·å–
- **æ”¹é€ éš¾åº¦**ï¼šâ­â­ æç®€ï¼ˆå‡ ä¹ä¸éœ€è¦æ›´æ–°ï¼‰
- **é¢„æœŸæ”¶ç›Š**ï¼šä½
- **å»ºè®®**ï¼šå¯æ”¹é€ ï¼Œä½†ä¼˜å…ˆçº§ä¸é«˜ã€‚è€ƒè™‘æ”¹ä¸ºä»…åœ¨åˆå§‹åŒ–æ—¶æ‰§è¡Œä¸€æ¬¡

#### 10. `tushare_stock_namechange` - è‚¡ç¥¨æ”¹å
- **è¡¨å**ï¼š`stock_namechange`
- **æ•°æ®é‡**ï¼šå°ï¼ˆ~200-300 æ¡è®°å½•ï¼‰
- **æ›´æ–°é¢‘ç‡**ï¼šå¾ˆä½ï¼ˆè‚¡ç¥¨æ”¹åäº‹ä»¶å¾ˆå°‘ï¼‰
- **ç‰¹ç‚¹**ï¼šå…¬å‘Šç±»æ•°æ®ï¼Œæ–°å¢è®°å½•å¾ˆå°‘
- **API ç‰¹æ€§**ï¼šæ”¯æŒæŒ‰ `ann_date` å¢é‡æŸ¥è¯¢ âœ“
- **æ”¹é€ éš¾åº¦**ï¼šâ­â­â­ ç®€å•ï¼Œä½†å·²æ”¯æŒå¢é‡
- **é¢„æœŸæ”¶ç›Š**ï¼šä½
- **å»ºè®®**ï¼šç°æœ‰å¢é‡æœºåˆ¶å·²è¶³å¤Ÿï¼Œæš‚ä¸éœ€è¦æ”¹é€ 

#### 11. `tushare_stock_repurchase` - è‚¡ç¥¨å›è´­
- **è¡¨å**ï¼š`stock_repurchase`
- **æ•°æ®é‡**ï¼šå°ï¼ˆ~1000 æ¡è®°å½•ï¼‰
- **æ›´æ–°é¢‘ç‡**ï¼šä½ï¼ˆå›è´­äº‹ä»¶ç›¸å¯¹é¢‘ç¹ä½†ä¸å¯†é›†ï¼‰
- **ç‰¹ç‚¹**ï¼šå…¬å‘Šç±»æ•°æ®
- **API ç‰¹æ€§**ï¼šæ”¯æŒæŒ‰ `ann_date` å¢é‡æŸ¥è¯¢ âœ“
- **æ”¹é€ éš¾åº¦**ï¼šâ­â­â­ ç®€å•ï¼Œä½†å·²æ”¯æŒå¢é‡
- **é¢„æœŸæ”¶ç›Š**ï¼šä½
- **å»ºè®®**ï¼šç°æœ‰å¢é‡æœºåˆ¶å·²è¶³å¤Ÿï¼Œæš‚ä¸éœ€è¦æ”¹é€ 

#### 12. `tushare_stock_dividend` - è‚¡ç¥¨åˆ†çº¢
- **è¡¨å**ï¼š`stock_dividend`
- **æ•°æ®é‡**ï¼šä¸­ç­‰ï¼ˆ~50,000+ æ¡è®°å½•ï¼Œæ¯ä¸ªè‚¡ç¥¨å¤šå¹´å¤šæ¬¡åˆ†çº¢ï¼‰
- **æ›´æ–°é¢‘ç‡**ï¼šä¸­ç­‰ï¼ˆæ¯å¹´ 3-4 æ¬¡æ–°å¢æ•°æ®ï¼‰
- **ç‰¹ç‚¹**ï¼šå†å²æ•°æ®ï¼Œæ–°å¢è®°å½•ç›¸å¯¹æœ‰é™
- **API ç‰¹æ€§**ï¼šæ”¯æŒæŒ‰ `ex_date` å¢é‡æŸ¥è¯¢ âœ“
- **æ”¹é€ éš¾åº¦**ï¼šâ­â­â­ ç®€å•ï¼Œä½†å·²æ”¯æŒå¢é‡
- **é¢„æœŸæ”¶ç›Š**ï¼šä½
- **å»ºè®®**ï¼šç°æœ‰å¢é‡æœºåˆ¶å·²è¶³å¤Ÿï¼Œæš‚ä¸éœ€è¦æ”¹é€ 

#### 13. `akshare_fund_cf_em` - åŸºé‡‘æ‹†åˆ†ï¼ˆAkShareï¼‰
- **è¡¨å**ï¼š`fund_cf_em`
- **æ•°æ®é‡**ï¼šä¸­ç­‰ï¼ˆ~1700 æ¡å†å²è®°å½•ï¼Œæ–°å¢å¾ˆå°‘ï¼‰
- **æ›´æ–°é¢‘ç‡**ï¼šå¾ˆä½ï¼ˆå‡ ä¹æ— æ–°å¢ï¼‰
- **ç‰¹ç‚¹**ï¼šå…¨å†å²æ•°æ®ï¼Œä¸€æ¬¡æ€§è·å–å®Œæ•´
- **API ç‰¹æ€§**ï¼šä¸æ”¯æŒå‚æ•°ï¼Œå…¨é‡è·å–
- **æ”¹é€ éš¾åº¦**ï¼šâ­â­â­ ç®€å•
- **é¢„æœŸæ”¶ç›Š**ï¼šä½
- **å»ºè®®**ï¼šå¯æ”¹é€ ï¼Œä½†ç”±äºæ–°å¢å¾ˆå°‘ï¼Œå®é™…æ”¶ç›Šæœ‰é™

#### 14. `akshare_fund_fh_em` - åŸºé‡‘åˆ†çº¢ï¼ˆAkShareï¼‰
- **è¡¨å**ï¼š`fund_fh_em`
- **æ•°æ®é‡**ï¼šå¤§ï¼ˆ~6000+ æ¡å†å²è®°å½•ï¼Œæ¯å¹´æŒç»­æ–°å¢ï¼‰
- **æ›´æ–°é¢‘ç‡**ï¼šä½ï¼ˆæ¯å¹´ 3-4 æ¬¡æ–°å¢ï¼‰
- **ç‰¹ç‚¹**ï¼šå…¨å†å²æ•°æ®ï¼Œæ¯å¹´å¹´åº•å¯èƒ½æœ‰æ–°å¢
- **API ç‰¹æ€§**ï¼šä¸æ”¯æŒå‚æ•°ï¼Œå…¨é‡è·å–
- **æ”¹é€ éš¾åº¦**ï¼šâ­â­â­â­ ä¸­ç­‰ï¼ˆéœ€è€ƒè™‘ AkShare çš„å®é™…è°ƒç”¨ï¼‰
- **é¢„æœŸæ”¶ç›Š**ï¼šä¸­
- **å»ºè®®**ï¼šå¯æ”¹é€ ï¼Œé¿å…æ¯å‘¨éƒ½å…¨é‡åˆ·æ–° 6000+ æ¡

---

### ğŸŸ¡ P3 ä¼˜å…ˆçº§ï¼ˆå¯é€‰æ”¹é€ ï¼‰

è¿™äº›ä»»åŠ¡**è™½ç„¶æ˜¯å…¨é‡ä»»åŠ¡**ï¼Œä½†**ç‰¹æ®ŠåŸå› **å¯¼è‡´æ”¹é€ ä»·å€¼ç›¸å¯¹æœ‰é™ã€‚

#### 15. `akshare_stock_limitup_reason` - æ¶¨åœåŸå› ï¼ˆAkShareï¼‰
- **è¡¨å**ï¼š`stock_limitup_reason`
- **æ•°æ®é‡**ï¼šå¾ˆå¤§ï¼ˆæ¯å¤©æ•°åƒæ¡æ¶¨åœè®°å½•ï¼‰
- **æ›´æ–°é¢‘ç‡**ï¼šé«˜ï¼ˆæ¯ä¸ªäº¤æ˜“æ—¥éƒ½æœ‰æ–°æ•°æ®ï¼‰
- **ç‰¹ç‚¹**ï¼šæ—¥é¢‘æ•°æ®ï¼Œéœ€è¦æ¯ä¸ªäº¤æ˜“æ—¥éƒ½æ›´æ–°
- **API ç‰¹æ€§**ï¼šæ”¯æŒ `start_date, end_date` å¢é‡æŸ¥è¯¢ âœ“
- **æ”¹é€ éš¾åº¦**ï¼šâ­â­â­ å·²æ”¯æŒæ™ºèƒ½å¢é‡ï¼ˆ`UpdateTypes.SMART` é»˜è®¤å€¼ï¼‰
- **é¢„æœŸæ”¶ç›Š**ï¼šä¸­
- **å»ºè®®**ï¼šå·²éƒ¨åˆ†æ”¹é€ ï¼ˆä½¿ç”¨ SMART é»˜è®¤å€¼ï¼‰ï¼Œå¯ä¿æŒåŸæ ·æˆ–è¿›ä¸€æ­¥å¼ºåŒ–

---

## æ¨èæ”¹é€ æµç¨‹

### ç¬¬ä¸€é˜¶æ®µï¼ˆP1 ä¼˜å…ˆçº§ï¼Œé¢„æœŸæ—¶é—´ï¼š2-3 å°æ—¶ï¼‰

æ”¹é€ ä»¥ä¸‹åŸºé‡‘å’ŒæŒ‡æ•°åŸºç¡€ä¿¡æ¯ä»»åŠ¡ï¼Œè¿™äº›ä»»åŠ¡æ”¹é€ **æœ€ç®€å•**ä¸”**æ”¶ç›Šæ˜æ˜¾**ï¼š

1. `tushare_fund_basic`
2. `tushare_fund_etf_basic`
3. `tushare_fund_etf_index`
4. `tushare_index_basic`
5. `tushare_index_swmember`
6. `tushare_index_cimember`

**æ”¹é€ æ­¥éª¤æ¨¡æ¿**ï¼ˆå‚è€ƒ `tushare_stock_thsindex.py`ï¼‰ï¼š

```python
# 1. æ·»åŠ å¯¼å…¥
from datetime import datetime, timedelta
from ...tools.calendar import is_trade_day
from ....common.constants import UpdateTypes

# 2. ä¿®æ”¹ docstring è¯´æ˜æ™ºèƒ½å¢é‡ç­–ç•¥
"""
è¯´æ˜ï¼šè¯¥æ¥å£ä¸æ”¯æŒçœŸæ­£çš„å¢é‡æ›´æ–°ã€‚
åœ¨ SMART æ¨¡å¼ä¸‹ï¼Œé‡‡ç”¨"è¶…è¿‡1ä¸ªæœˆæœªæ›´æ–°ä¸”å½“å¤©ä¸ºéäº¤æ˜“æ—¥"æ—¶æ‰æ‰§è¡Œå…¨é‡æ›´æ–°ï¼Œå¦åˆ™è·³è¿‡ã€‚
"""

# 3. ä¿®æ”¹ get_batch_list æ–¹æ³•
async def get_batch_list(self, **kwargs: Any) -> List[Dict]:
    update_type = kwargs.get("update_type", UpdateTypes.FULL)
    
    if update_type == UpdateTypes.SMART:
        should_update = await self._should_perform_full_update()
        if not should_update:
            self.logger.info(f"ä»»åŠ¡ {self.name}: æ™ºèƒ½å¢é‡ - ä¸æ»¡è¶³å…¨é‡æ›´æ–°æ¡ä»¶ï¼Œè·³è¿‡æ‰§è¡Œ")
            return []
        self.logger.info(f"ä»»åŠ¡ {self.name}: æ™ºèƒ½å¢é‡ - æ»¡è¶³å…¨é‡æ›´æ–°æ¡ä»¶ï¼Œè½¬ä¸ºå…¨é‡æ›´æ–°")
    elif update_type != UpdateTypes.FULL:
        self.logger.warning(
            f"ä»»åŠ¡ {self.name}: æ­¤ä»»åŠ¡ä»…æ”¯æŒå…¨é‡æ›´æ–° (FULL) å’Œæ™ºèƒ½å¢é‡ (SMART)ã€‚"
            f"å½“å‰æ›´æ–°ç±»å‹ä¸º '{update_type}'ï¼Œä»»åŠ¡å°†è·³è¿‡æ‰§è¡Œã€‚"
        )
        return []
    
    self.logger.info(f"ä»»åŠ¡ {self.name}: å…¨é‡è·å–æ¨¡å¼ï¼Œç”Ÿæˆå•ä¸€æ‰¹æ¬¡ã€‚")
    return [{}]

# 4. æ·»åŠ  _should_perform_full_update æ–¹æ³•
async def _should_perform_full_update(self) -> bool:
    try:
        query = f"SELECT MAX(update_time) as last_update FROM {self.data_source}.{self.table_name}"
        result = await self.db.fetch(query)
        
        if not result or not result[0]["last_update"]:
            self.logger.info(f"è¡¨ {self.table_name} æ²¡æœ‰æ›´æ–°æ—¶é—´è®°å½•ï¼Œéœ€è¦æ‰§è¡Œå…¨é‡æ›´æ–°")
            return True
        
        last_update = result[0]["last_update"]
        current_time = datetime.now()
        time_diff = current_time - last_update
        
        is_over_one_month = time_diff > timedelta(days=30)
        
        today_str = current_time.strftime("%Y%m%d")
        is_trading_day = await is_trade_day(today_str)
        is_non_trading_day = not is_trading_day
        
        self.logger.info(
            f"è¡¨ {self.table_name} æœ€åæ›´æ–°æ—¶é—´ä¸º {last_update}ï¼Œ"
            f"è·ç¦»ç°åœ¨ {time_diff.days} å¤©ï¼Œæ˜¯å¦è¶…è¿‡1ä¸ªæœˆ: {is_over_one_month}ï¼Œ"
            f"å½“å¤© {today_str} æ˜¯å¦ä¸ºéäº¤æ˜“æ—¥: {is_non_trading_day}"
        )
        
        return bool(is_over_one_month and is_non_trading_day)
    except Exception as e:
        self.logger.error(f"æ£€æŸ¥è¡¨ {self.table_name} æ›´æ–°æ—¶é—´å¤±è´¥: {e}", exc_info=True)
        return True
```

### ç¬¬äºŒé˜¶æ®µï¼ˆP1 ä¸­ç­‰éš¾åº¦ + P2ï¼Œé¢„æœŸæ—¶é—´ï¼š2-4 å°æ—¶ï¼‰

æ”¹é€ ä»¥ä¸‹ä»»åŠ¡ï¼Œéœ€è¦**ä¿ç•™ç°æœ‰çš„åˆ†æ‰¹é€»è¾‘**ï¼š

7. `tushare_stock_basic` - éœ€ä¿ç•™ BatchPlanner åˆ†æ‰¹é€»è¾‘
8. `tushare_stock_dcmember` - éœ€ä¿ç•™æœˆæœ«åˆ†æ‰¹é€»è¾‘
9. `akshare_fund_fh_em` - éœ€è€ƒè™‘ AkShare çš„å®é™…ç‰¹æ€§

### ç¬¬ä¸‰é˜¶æ®µï¼ˆP3 å’Œå¯é€‰é¡¹ï¼Œé¢„æœŸæ—¶é—´ï¼š1-2 å°æ—¶ï¼‰

10. `akshare_fund_cf_em` - å¯é€‰æ”¹é€ 
11. å…¶ä»– P3 ä¼˜å…ˆçº§ä»»åŠ¡ - å¯é€‰

---

## æ”¹é€ å‰åå¯¹æ¯”

### æ”¹é€ å‰ï¼ˆæ— æ™ºèƒ½å¢é‡ï¼‰
```
ç”Ÿäº§è°ƒåº¦å™¨æ¯å¤©å‡Œæ™¨ 2 ç‚¹è¿è¡Œï¼š
Day 1: å…¨é‡æ›´æ–° fund_basicï¼ˆ~10,000 æ¡ï¼‰âœ“
Day 2: å…¨é‡æ›´æ–° fund_basicï¼ˆ~10,000 æ¡ï¼‰âœ“ æœ¬æ¥å¯ä»¥è·³è¿‡
Day 3: å…¨é‡æ›´æ–° fund_basicï¼ˆ~10,000 æ¡ï¼‰âœ“ æœ¬æ¥å¯ä»¥è·³è¿‡
...
Day 32: å…¨é‡æ›´æ–° fund_basicï¼ˆ~10,000 æ¡ï¼‰âœ“ çœŸçš„éœ€è¦æ›´æ–°
```

### æ”¹é€ åï¼ˆæœ‰æ™ºèƒ½å¢é‡ï¼‰
```
ç”Ÿäº§è°ƒåº¦å™¨æ¯å¤©å‡Œæ™¨ 2 ç‚¹è¿è¡Œï¼ˆä½¿ç”¨ UpdateTypes.SMARTï¼‰ï¼š
Day 1 (äº¤æ˜“æ—¥): å…¨é‡æ›´æ–° fund_basic âœ“ 
Day 2 (äº¤æ˜“æ—¥): SMART åˆ¤æ–­ â†’ è·ç¦» Day 1 ä»… 1 å¤©ï¼Œä¸”ä»Šå¤©æ˜¯äº¤æ˜“æ—¥ â†’ è·³è¿‡ âœ“
Day 3 (äº¤æ˜“æ—¥): SMART åˆ¤æ–­ â†’ è·ç¦» Day 1 ä»… 2 å¤©ï¼Œä¸”ä»Šå¤©æ˜¯äº¤æ˜“æ—¥ â†’ è·³è¿‡ âœ“
...
Day 32 (éäº¤æ˜“æ—¥ï¼Œå‘¨æœ«/èŠ‚å‡æ—¥): SMART åˆ¤æ–­ â†’ è·ç¦»ä¸Šæ¬¡è¶…è¿‡ 30 å¤©ï¼Œä¸”ä»Šå¤©éäº¤æ˜“æ—¥ â†’ æ›´æ–° âœ“
```

**é¢„æœŸèŠ‚çœ**ï¼š
- å•ä¸ªä»»åŠ¡ï¼šæ¯ä¸ªæœˆèŠ‚çœ ~29-30 æ¬¡æ— ç”¨å…¨é‡æ›´æ–°
- 6 ä¸ªä»»åŠ¡ç»„åˆï¼šæ¯æœˆèŠ‚çœ ~174-180 æ¬¡æ•°æ®åº“æŸ¥è¯¢å’Œç½‘ç»œè¯·æ±‚
- å¹´åº¦ç´¯è®¡ï¼š~2100+ æ¬¡ä¸å¿…è¦çš„ API è°ƒç”¨ï¼ŒèŠ‚çœåŸºç¡€è®¾æ–½æˆæœ¬

---

## é‡è¦æ³¨æ„äº‹é¡¹

1. **äº¤æ˜“æ—¥å†ä¾èµ–**ï¼šæ”¹é€ åçš„ä»»åŠ¡**ä¾èµ–** `alphahome.common.tools.calendar.is_trade_day()` å‡½æ•°
   - ç¡®ä¿è¯¥å‡½æ•°å·²å®ç°ä¸”æ­£ç¡®
   - è¯¥å‡½æ•°åŸºäº `alphahome.trade_calendar` è¡¨

2. **é¦–æ¬¡æ›´æ–°**ï¼š
   - å¦‚æœç›®æ ‡è¡¨ä¸ºç©ºï¼ˆç¬¬ä¸€æ¬¡è¿è¡Œï¼‰ï¼Œ`max(update_time) = NULL`ï¼Œè‡ªåŠ¨è§¦å‘å…¨é‡æ›´æ–° âœ“
   - æ— éœ€é¢å¤–å¤„ç†

3. **æ—¶é—´æˆ³è¦æ±‚**ï¼š
   - æ‰€æœ‰æ”¹é€ çš„è¡¨å¿…é¡»æœ‰ `update_time` åˆ—ï¼ˆè‡ªåŠ¨æ·»åŠ ï¼Œ`auto_add_update_time=True`ï¼‰
   - è¯¥åˆ—å¿…é¡»ç”±ä»»åŠ¡æ¡†æ¶è‡ªåŠ¨ç»´æŠ¤

4. **ä¸ç°æœ‰å¢é‡ä»»åŠ¡çš„åè°ƒ**ï¼š
   - å·²æ”¯æŒçœŸæ­£å¢é‡æŸ¥è¯¢çš„ä»»åŠ¡ï¼ˆå¦‚ `tushare_stock_daily`ï¼‰**æ— éœ€æ”¹é€ **
   - è¿™ä¸ªç­–ç•¥ä»…é€‚ç”¨äº**ä¸æ”¯æŒå¢é‡æŸ¥è¯¢çš„å…¨é‡ä»»åŠ¡**

5. **é…ç½®æ–‡ä»¶**ï¼š
   - ç”Ÿäº§è°ƒåº¦å™¨éœ€è¦ä¸ºè¿™äº›ä»»åŠ¡è®¾ç½® `update_type: "SMART"` è€Œéé»˜è®¤çš„ `"FULL"`
   - é…ç½®ç¤ºä¾‹ï¼šè§ `docs/setup/configuration.md` æˆ– `config.example.json`

---

## æ€»ç»“è¡¨æ ¼

| ä¼˜å…ˆçº§ | ä»»åŠ¡å | è¡¨å | æ•°æ®é‡ | æ”¹é€ éš¾åº¦ | é¢„æœŸæ”¶ç›Š |
|------|------|------|------|--------|--------|
| P1 | tushare_fund_basic | fund_basic | ä¸­ç­‰ | ç®€å• | é«˜ |
| P1 | tushare_fund_etf_basic | fund_etf_basic | ä¸­ç­‰ | ç®€å• | é«˜ |
| P1 | tushare_fund_etf_index | fund_etf_index | ä¸­ç­‰ | ç®€å• | é«˜ |
| P1 | tushare_index_basic | index_basic | ä¸­ç­‰ | ç®€å• | ä¸­ |
| P1 | tushare_index_swmember | index_swmember | ä¸­ç­‰ | ç®€å• | ä¸­ |
| P1 | tushare_index_cimember | index_cimember | ä¸­ç­‰ | ç®€å• | ä¸­ |
| P1 | tushare_stock_basic | stock_basic | ä¸­ç­‰ | ä¸­ç­‰ | ä¸­ |
| P1 | tushare_stock_dcmember | stock_dcmember | ä¸­ç­‰ | ä¸­ç­‰ | ä¸­ |
| P2 | tushare_stock_codemapping | stock_codemapping | å° | æç®€ | ä½ |
| P2 | akshare_fund_fh_em | fund_fh_em | ä¸­ç­‰ | ä¸­ç­‰ | ä¸­ |
| P2 | akshare_fund_cf_em | fund_cf_em | ä¸­ç­‰ | ç®€å• | ä½ |
| P3 | akshare_stock_limitup_reason | stock_limitup_reason | å¤§ | ç®€å•* | ä¸­ |

*å·²éƒ¨åˆ†æ”¹é€ 

---

**æ–‡æ¡£åˆ›å»ºæ—¥æœŸ**ï¼š2025-12-12  
**æœ€åæ›´æ–°**ï¼š2025-12-12
