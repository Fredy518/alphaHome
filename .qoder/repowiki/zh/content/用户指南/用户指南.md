# 用户指南

<cite>
**本文档引用的文件**  
- [main_window.py](file://alphahome/gui/main_window.py)
- [pyproject.toml](file://pyproject.toml)
- [data_collection_tab.py](file://alphahome/gui/ui/data_collection_tab.py)
- [data_processing_tab.py](file://alphahome/gui/ui/data_processing_tab.py)
- [task_execution_tab.py](file://alphahome/gui/ui/task_execution_tab.py)
- [storage_settings_tab.py](file://alphahome/gui/ui/storage_settings_tab.py)
- [data_collection_handler.py](file://alphahome/gui/handlers/data_collection_handler.py)
- [data_processing_handler.py](file://alphahome/gui/handlers/data_processing_handler.py)
- [task_execution_handler.py](file://alphahome/gui/handlers/task_execution_handler.py)
- [storage_settings_handler.py](file://alphahome/gui/handlers/storage_settings_handler.py)
- [constants.py](file://alphahome/common/constants.py)
</cite>

## 目录
1. [简介](#简介)
2. [GUI使用指南](#gui使用指南)
3. [CLI使用指南](#cli使用指南)
4. [常见工作流](#常见工作流)
5. [错误处理提示](#错误处理提示)

## 简介

AlphaHome智能量化投研系统提供图形用户界面（GUI）和命令行界面（CLI）两种操作方式，用于数据采集、处理和任务执行。本指南将详细介绍两种使用方式的操作流程和交互细节。

## GUI使用指南

### 数据采集标签页

数据采集标签页允许用户选择和管理从不同数据源获取原始数据的任务。

**功能与操作流程**：
- **刷新列表**：点击"刷新列表"按钮可重新加载所有可用的数据采集任务
- **全选/取消全选**：快速选择或取消选择所有任务
- **过滤功能**：通过名称、数据源和类型三个维度过滤任务列表
- **任务选择**：在"选择"列点击可切换单个任务的选中状态

**用户交互细节**：
- 任务列表以表格形式展示，包含选择、数据源、类型、名称、描述和更新时间等列
- 支持按任意列进行排序，点击列标题可切换升序/降序
- 过滤器支持实时筛选，输入内容后自动更新显示结果
- 列表支持DPI自适应，确保在高分辨率屏幕上显示效果良好

**截图位置建议**：
建议截取完整的数据采集标签页，包含顶部的过滤区域和下方的任务列表表格，以展示完整的用户界面布局。

**Section sources**
- [data_collection_tab.py](file://alphahome/gui/ui/data_collection_tab.py#L1-L130)
- [data_collection_handler.py](file://alphahome/gui/handlers/data_collection_handler.py#L1-L232)

### 数据处理标签页

数据处理标签页用于选择和管理对已采集数据进行加工处理的任务。

**功能与操作流程**：
- **刷新列表**：点击"刷新列表"按钮可重新加载所有可用的数据处理任务
- **全选/取消全选**：快速选择或取消选择所有任务
- **任务选择**：在"选择"列点击可切换单个任务的选中状态

**用户交互细节**：
- 任务列表包含选择、名称、描述和类型四列
- 选择列宽度固定，名称和描述列支持拉伸以适应窗口大小
- 与数据采集标签页类似，支持DPI自适应显示
- 任务选择状态会保存在内存中，直到应用关闭

**截图位置建议**：
建议截取数据处理标签页的完整视图，重点展示任务列表的布局和列标题，以及顶部的控制按钮。

**Section sources**
- [data_processing_tab.py](file://alphahome/gui/ui/data_processing_tab.py#L1-L82)
- [data_processing_handler.py](file://alphahome/gui/handlers/data_processing_handler.py#L1-L142)

### 任务执行标签页

任务执行标签页是系统的核心操作界面，用于配置和执行选中的数据采集和处理任务。

**功能与操作流程**：
1. **执行模式选择**：
   - 智能增量：系统自动判断需要更新的数据范围
   - 手动增量：用户手动指定日期范围
   - 全量更新：重新处理所有数据

2. **日期选择**（仅手动增量模式可用）：
   - 开始日期：选择数据更新的起始日期
   - 结束日期：选择数据更新的结束日期

3. **数据保存策略**：
   - 使用INSERT模式：跳过重复数据检查，提高保存速度，但可能产生重复数据
   - 不使用INSERT模式：检查并处理重复数据，保存速度较慢但数据更安全

4. **任务控制**：
   - 运行任务：开始执行选中的任务
   - 停止任务：中断正在执行的任务

**用户交互细节**：
- 右侧分为上下两个面板：任务状态和运行日志
- 任务状态面板显示当前执行任务的详细信息，包括任务名称、最后状态、更新时间和详情
- 运行日志面板以不同颜色显示不同级别的日志信息（黑色-信息，橙色-警告，红色-错误，绿色-成功）
- 支持切换显示当前会话任务或历史任务
- 状态树和日志视图均支持DPI自适应

**截图位置建议**：
建议截取任务执行标签页的完整视图，展示左侧的控制面板和右侧的状态/日志面板，特别要包含执行模式的单选按钮组和数据保存策略的复选框。

**Section sources**
- [task_execution_tab.py](file://alphahome/gui/ui/task_execution_tab.py#L1-L234)
- [task_execution_handler.py](file://alphahome/gui/handlers/task_execution_handler.py#L1-L332)

### 存储设置标签页

存储设置标签页用于配置系统的数据存储和外部API访问参数。

**功能与操作流程**：
1. **PostgreSQL设置**：
   - 主机：数据库服务器地址
   - 端口：数据库端口（默认5432）
   - 数据库名：目标数据库名称
   - 用户名：数据库用户名
   - 密码：数据库密码

2. **Tushare设置**：
   - Tushare Token：用于访问Tushare API的认证令牌

3. **显示设置**：
   - 显示当前分辨率、DPI缩放比例等信息
   - 提供显示模式选择：自动检测、标准模式、高DPI模式、4K优化模式
   - 显示系统推荐的显示模式

4. **操作按钮**：
   - 加载当前设置：从配置文件加载当前设置
   - 保存设置：保存修改后的设置
   - 测试数据库连接：验证数据库配置是否正确

**用户交互细节**：
- 数据库设置区域的密码字段以星号显示
- 显示设置区域会根据当前系统环境自动推荐最佳显示模式
- 应用显示设置后需要重启应用才能生效
- 保存操作仅更新Tushare Token，数据库设置为只读状态

**截图位置建议**：
建议截取存储设置标签页的完整视图，重点展示PostgreSQL和Tushare设置区域，以及显示设置中的推荐模式提示。

**Section sources**
- [storage_settings_tab.py](file://alphahome/gui/ui/storage_settings_tab.py#L1-L158)
- [storage_settings_handler.py](file://alphahome/gui/handlers/storage_settings_handler.py#L1-L119)

## CLI使用指南

### alphahome命令

通过`pyproject.toml`文件中的配置，系统提供了`alphahome`命令行工具，用于启动图形界面。

```bash
# 启动GUI应用程序
alphahome
```

此命令等同于运行`python -m alphahome.gui.main_window`，启动系统的图形用户界面。

### 其他CLI命令

系统还提供了其他命令行工具，如`refresh-materialized-view`，用于刷新物化视图。

```bash
# 刷新物化视图
refresh-materialized-view
```

这些命令的详细使用方法可参考相关文档。

**Section sources**
- [pyproject.toml](file://pyproject.toml#L1-L154)

## 常见工作流

### 选择任务并执行的完整流程

1. **选择数据采集任务**：
   - 切换到"数据采集"标签页
   - 点击"刷新列表"确保任务列表为最新
   - 使用过滤器缩小任务范围
   - 通过点击"选择"列或使用"全选"/"取消全选"按钮选择需要的任务

2. **选择数据处理任务**：
   - 切换到"数据处理"标签页
   - 点击"刷新列表"确保任务列表为最新
   - 选择需要执行的数据处理任务

3. **配置更新模式**：
   - 切换到"任务运行"标签页
   - 根据需求选择执行模式：
     - **全量更新**：当需要重新处理所有历史数据时选择
     - **增量更新**：当只需要更新最新数据时选择
     - **智能增量**：系统自动判断最优更新策略，推荐日常使用

4. **配置日期范围**（仅手动增量模式）：
   - 在"开始日期"和"结束日期"字段中选择需要处理的日期范围
   - 确保日期格式为YYYY-MM-DD

5. **配置数据保存策略**：
   - 如果追求速度且确认数据源无重复，可勾选"使用INSERT模式"
   - 如果数据质量优先，建议不勾选此选项

6. **监控执行状态**：
   - 点击"运行任务"按钮开始执行
   - 在右侧的"任务状态"面板中监控各个任务的执行进度
   - 在"运行日志"面板中查看详细的执行日志
   - 如需中断执行，可点击"停止任务"按钮

**Section sources**
- [main_window.py](file://alphahome/gui/main_window.py#L1-L412)
- [constants.py](file://alphahome/common/constants.py#L1-L23)

## 错误处理提示

### 常见错误及解决方案

1. **数据库连接失败**：
   - 检查PostgreSQL设置中的主机、端口、数据库名、用户名和密码是否正确
   - 使用"测试数据库连接"按钮验证配置
   - 确保数据库服务器正在运行且网络连接正常

2. **Tushare API访问失败**：
   - 检查Tushare Token是否正确
   - 确认Token具有访问所需数据的权限
   - 检查网络连接是否正常

3. **任务执行失败**：
   - 查看运行日志中的错误信息
   - 检查相关数据源是否正常提供数据
   - 尝试重新执行任务

4. **DPI显示问题**：
   - 在"存储设置"标签页中尝试不同的显示模式
   - 重启应用使显示设置生效
   - 确保系统DPI设置与应用设置匹配

5. **日期格式错误**：
   - 确保手动输入的日期格式为YYYY-MM-DD
   - 建议使用日期选择控件而非手动输入

### 一般性建议

- 在执行重要任务前，建议先在测试环境中验证配置
- 定期备份重要数据，防止意外丢失
- 执行全量更新前，确保有足够的磁盘空间和执行时间
- 遇到无法解决的问题时，可联系技术支持获取帮助

**Section sources**
- [main_window.py](file://alphahome/gui/main_window.py#L284-L288)
- [task_execution_handler.py](file://alphahome/gui/handlers/task_execution_handler.py#L62-L87)