# 获取行业分类数据

<cite>
**本文档引用的文件**  
- [data_access.py](file://alphahome/providers/data_access.py#L402-L449)
- [_helpers.py](file://alphahome/providers/_helpers.py#L265-L334)
- [context.py](file://research/tools/context.py#L404-L406)
</cite>

## 目录
1. [方法概述](#方法概述)
2. [参数详解](#参数详解)
3. [返回值说明](#返回值说明)
4. [内部实现逻辑](#内部实现逻辑)
5. [使用示例](#使用示例)
6. [应用场景](#应用场景)
7. [扩展性与未来规划](#扩展性与未来规划)

## 方法概述

`get_industry_data` 方法用于获取股票的行业分类信息。该方法是 AlphaHome 数据访问系统中的核心方法之一，通过封装数据库查询逻辑，为用户提供简洁的行业数据获取接口。

该方法主要从 `tushare.stock_basic` 数据表中提取行业信息，适用于需要快速获取股票行业归属的研究和分析场景。方法设计遵循“简单优于复杂”的原则，提供直观的参数接口和稳定的返回格式。

**Section sources**
- [data_access.py](file://alphahome/providers/data_access.py#L402-L449)

## 参数详解

### symbols 参数（可选）

`symbols` 参数用于筛选特定的股票代码，支持单个股票代码或股票代码列表的输入。

- **类型**: `Optional[Union[str, List[str]]]`
- **默认值**: `None`
- **功能**: 当提供股票代码时，方法仅返回这些股票的行业信息；当为 `None` 时，返回全市场所有股票的行业信息。
- **使用场景**: 适用于需要对特定股票池（如指数成分股、自选股）进行行业分析的场景。

### industry_type 参数（兼容性保留）

`industry_type` 参数目前主要用于保持向后兼容性。

- **类型**: `str`
- **默认值**: `'SW2021'`
- **功能**: 该参数在当前实现中未被实际使用，其值不会影响查询结果。保留此参数是为了确保与旧版代码的兼容性，避免因接口变更导致的代码中断。
- **注意**: 尽管参数存在，但当前系统仅提供基于 `tushare.stock_basic` 表的单一行业分类标准。

### active_only 参数

`active_only` 参数用于控制是否仅返回上市交易的股票。

- **类型**: `bool`
- **默认值**: `False`
- **功能**: 
  - 当设置为 `True` 时，查询条件中会添加 `list_status = 'L'`，只返回上市状态（Listed）的股票。
  - 当设置为 `False` 时，返回所有股票，包括已退市或暂停上市的股票。
- **实现方式**: 该参数通过动态构建 SQL 查询的 `WHERE` 子句来实现，根据参数值决定是否添加上市状态筛选条件。

**Section sources**
- [data_access.py](file://alphahome/providers/data_access.py#L404-L407)

## 返回值说明

该方法返回一个包含以下三列的 `pandas.DataFrame`：

- **ts_code**: 股票代码，采用 Tushare 风格的代码格式（如 '000001.SZ'）。
- **industry_name**: 行业名称，直接从 `tushare.stock_basic` 表的 `industry` 字段获取。
- **industry_code**: 行业代码，当前实现中与 `industry_name` 相同，均来自 `industry` 字段。

返回的 DataFrame 按 `ts_code` 排序，确保结果的可预测性。当查询无结果时，返回一个空的 DataFrame。

**Section sources**
- [data_access.py](file://alphahome/providers/data_access.py#L419-L420)

## 内部实现逻辑

### 数据源与查询逻辑

`get_industry_data` 方法的核心数据源是 `tushare.stock_basic` 表。该表存储了股票的基本信息，其中 `industry` 字段包含了股票的行业分类信息。

查询逻辑如下：
1. 构建基础查询语句，选择 `ts_code`、`industry`（作为 `industry_name` 和 `industry_code`）。
2. 根据 `active_only` 参数决定是否添加 `WHERE list_status = 'L'` 条件。
3. 根据 `symbols` 参数决定是否添加 `ts_code IN (...)` 条件。
4. 最后按 `ts_code` 排序。

### 与 get_stock_info 方法的相似性

`get_industry_data` 方法在实现上与 `get_stock_info` 方法高度相似：
- 两者都从 `tushare.stock_basic` 表查询数据。
- 两者都支持 `symbols` 参数进行股票筛选。
- 两者都支持 `active_only` 参数来控制是否仅返回上市股票。
- 两者都使用相同的参数化查询方式来防止 SQL 注入。

主要区别在于 `get_industry_data` 是一个更专用的方法，只关注行业信息，而 `get_stock_info` 返回更全面的股票基本信息。

**Section sources**
- [data_access.py](file://alphahome/providers/data_access.py#L418-L441)

## 使用示例

### 获取全市场行业数据

```python
# 获取所有上市股票的行业信息
industry_data = data_tool.get_industry_data(active_only=True)
print(industry_data.head())
```

### 获取特定股票的行业数据

```python
# 获取单只股票的行业信息
single_stock_industry = data_tool.get_industry_data(symbols='000001.SZ', active_only=True)

# 获取多只股票的行业信息
selected_stocks = ['000001.SZ', '600519.SH', '002594.SZ']
portfolio_industry = data_tool.get_industry_data(symbols=selected_stocks, active_only=True)
```

### 在研究上下文中的使用

```python
# 在研究工具中使用
with ResearchContext() as context:
    # 获取行业数据
    industry_df = context.get_industry_data(symbols=['000001.SZ'])
    print(industry_df)
```

**Section sources**
- [context.py](file://research/tools/context.py#L404-L406)

## 应用场景

### 行业轮动分析

`get_industry_data` 方法是进行行业轮动分析的基础。通过获取股票的行业归属，可以：
- 计算各行业的市值权重。
- 分析不同行业的收益表现和风险特征。
- 构建行业轮动策略，根据宏观经济周期调整行业配置。

### 行业中性化处理

在因子研究和组合构建中，行业中性化是一个重要的步骤。该方法提供的行业信息可以用于：
- 在回归分析中加入行业虚拟变量，控制行业效应。
- 构建行业中性组合，消除行业配置对组合收益的影响。
- 进行风险归因分析，区分收益来源是来自行业还是个股选择。

**Section sources**
- [data_access.py](file://alphahome/providers/data_access.py#L402-L449)

## 扩展性与未来规划

尽管当前实现仅从 `tushare.stock_basic` 表获取行业信息，但系统具备良好的扩展性。未来可能支持更多行业分类标准，例如：
- 申万行业分类（通过 `tushare.index_swmember` 表）。
- 中信行业分类（通过 `tushare.index_cimember` 表）。
- 自定义行业分类。

通过扩展 `industry_type` 参数的功能，可以实现对不同行业标准的支持，满足更精细化的行业分析需求。同时，系统中已存在处理多级行业分类（如 `l1_code`, `l2_code`）的基础设施，为未来的扩展提供了技术基础。

**Section sources**
- [data_access.py](file://alphahome/providers/data_access.py#L405-L406)
- [_helpers.py](file://alphahome/providers/_helpers.py#L265-L334)